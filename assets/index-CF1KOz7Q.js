import{r as l,j as e,T as D,I as g}from"./index-DFMJk8BF.js";import{u as O}from"./index-CDrEZtDK.js";import{A as E}from"./index-CMB0Ikbr.js";import{u as J}from"./Model-CkONpvBT.js";import{B as T}from"./ButtonVoidText-BeIKjVNJ.js";import{L as S}from"./index-Cs_f-VNv.js";import"./Breadcrumbs-PNXGyQyV.js";const A=l.memo(({title:s})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:s}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]}));function B({title:s}){const{inputText:a,aiCallBack:n,isLoading:r,error:t}=l.useContext(k),{romaji:c,japanese:i}=n||{},o=()=>r?e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(S,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}):t?e.jsxs("p",{className:"text-red-500",children:["Lỗi: ",t.message||"Đã có lỗi xảy ra"]}):a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Nội dung:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(T,{text:a,language:"vi-VN"}),e.jsx("p",{children:a})]})]}),i&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Dịch:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(T,{text:i,language:"ja-JP"}),e.jsx("p",{children:i})]})]}),c&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800 italic text-sm",children:"Cách đọc:"}),e.jsx("p",{children:c})]})]}):e.jsx("p",{children:"Vui lòng nhập nội dung cần dịch."});return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-2xl p-5 ",children:[e.jsx(A,{title:s||"Dịch - Cách đọc"}),o()]})}const R=l.memo(({title:s})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:s}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]})),P=l.memo(({item:s})=>{const{special_structure:a,html:n,analysis:r}=s||{},t=i=>i?i.replace(/Aい/g,"A<sub>い</sub><sub class='text-gray-800 italic'>( Tính từ đuôi い)</sub>").replace(/Aな/g,"A<sub>な</sub><sub class='text-gray-800 italic'>( Tính từ đuôi な)</sub>").replace(/V(る|て|た|ない)/g,"V<sub>$1</sub>").replace("V-masu","V<sub>ます</sub>").replace("N/Na-adj","N<sub class='text-gray-800 italic'>( Danh từ )</sub>").replace(/\*\*(.*?)\*\*/g,"<br><b>$1</b><br>"):"",c=l.useMemo(()=>t(String(a)||""),[a]);return e.jsx(D,{title:`Chi tiết cấu trúc:${a}`||"",placement:"top",arrow:!0,children:e.jsxs("details",{className:"group cursor-pointer p-3 border-b last:border-0 border-gray-100 dark:border-gray-700",children:[e.jsx("summary",{className:"flex items-center justify-between list-none outline-none",children:e.jsx("div",{className:"text-sky-800 dark:text-sky-400 font-bold text-lg hover:text-sky-600 transition-colors",dangerouslySetInnerHTML:{__html:c}})}),e.jsx("div",{className:"grid grid-rows-[0fr] transition-all duration-300 ease-in-out group-open:grid-rows-[1fr]",children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"pt-3 pl-4 border-l-2 border-gray-200 dark:border-gray-600 ml-1 mt-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic",children:r})})})})]})})});function G({title:s}){const{aiCallBack:a,isLoading:n,error:r}=l.useContext(k),{list_structure:t}=a||{};return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-2xl p-5 ",children:[e.jsx(R,{title:s||"Phân tích"}),n&&e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(S,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}),(t==null?void 0:t.length)>0&&!n&&e.jsx("div",{className:"mt-2",children:e.jsx("ul",{className:" list-inside flex  flex-col gap-5",children:t.map((c,i)=>e.jsx("li",{className:"shadow shadow-gray-400 p-2 rounded-2xl",children:e.jsx(P,{item:c})},i))})}),!n&&(!t||t.length===0)&&e.jsx("p",{className:"text-center text-gray-400 mt-4 text-sm",children:"Không tìm thấy cấu trúc ngữ pháp đặc biệt."})]})}function V(){const{inputText:s,options:a,aiCallBack:n,isLoading:r}=l.useContext(k);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{iconName:"faCrown",className:"text-2xl text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Phân tích"})]}),e.jsx("h5",{className:"text-gray-400 text-sm italic",children:location.href})]}),e.jsxs("div",{className:"flex flex-col gap-5 select-text mt-2",children:[e.jsx(B,{title:"Dịch - cách đọc"}),e.jsx(G,{title:"Phân tích"})]})]})}function $({onClose:s,onRepeat:a}){const[n,r]=l.useState([]),t=()=>{try{const o=localStorage.getItem("dichHistory");if(o){const m=JSON.parse(o).map(p=>{const h=atob(p),N=decodeURIComponent(h);return JSON.parse(N)});r(m)}else r([])}catch(o){console.error("Failed to load history from localStorage:",o),localStorage.removeItem("dichHistory"),r([])}};l.useEffect(()=>{t()},[]);const c=()=>{window.confirm("Bạn có chắc chắn muốn xóa TOÀN BỘ lịch sử dịch? Thao tác này không thể hoàn tác.")&&(localStorage.removeItem("dichHistory"),r([]))},i=o=>{if(window.confirm("Bạn có chắc chắn muốn xóa mục này?")){const u=n.filter(p=>p.id!==o),m=u.map(p=>{const h=JSON.stringify(p);return btoa(encodeURIComponent(h))});localStorage.setItem("dichHistory",JSON.stringify(m)),r(u)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 flex justify-center items-center",onClick:s,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-[90%] max-w-2xl max-h-[80vh] flex flex-col",onClick:o=>o.stopPropagation(),children:[e.jsxs("header",{className:"flex flex-wrap justify-between items-center p-4 border-b dark:border-gray-600",children:[e.jsxs("h2",{className:"text-xl font-bold text-sky-800 dark:text-sky-400",children:[e.jsx(g,{iconName:"faClipboardList",className:"mr-2"}),"Lịch sử đã lưu"]}),e.jsxs("div",{className:"flex items-center justify-end  gap-4",children:[n.length>0&&e.jsxs("button",{onClick:c,title:"Xóa toàn bộ lịch sử",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(g,{iconName:"faTrashCan"}),e.jsx("span",{children:"Xóa tất cả"})]}),e.jsx("button",{onClick:s,className:"text-gray-600 border border-gray-300 px-3 py-1.5 text-sm font-medium rounded-md hover:text-red-800 dark:text-gray-300 dark:hover:text-white",children:"Đóng"})]})]}),e.jsx("main",{className:"p-5 overflow-y-auto",children:n.length>0?e.jsx("ul",{className:"space-y-3",children:n.slice().reverse().map(o=>{var u;return e.jsxs("li",{className:"flex justify-between w-full  items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 border-r mr-4",children:[e.jsx("button",{onClick:()=>a(o),title:"Dùng lại",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-sky-700 hover:text-sky-900 dark:text-sky-400 dark:hover:text-sky-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:e.jsx(g,{iconName:"faRepeat"})}),e.jsx("button",{onClick:()=>i(o.id),title:"Xóa mục này",className:"flex items-center justify-center w-8 h-8 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 rounded-md hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors",children:e.jsx(g,{iconName:"faTrashCan"})})]}),e.jsxs("div",{className:"w-full overflow-hidden mr-4",children:[e.jsx("p",{className:"text-gray-800 dark:text-gray-200 truncate",title:o.inputText,children:o.inputText}),e.jsxs("div",{className:" flex gap-2 text-xs italic text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("p",{children:"Phong cách : "}),e.jsx("p",{children:((u=o.options)==null?void 0:u.theLoaiGiaoTiep)||"không rõ"})]})]})]},o.id)})}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Chưa có lịch sử nào được lưu."})})]})})}function _({text:s,handleErase:a,handleButtonClick:n,isSendDisabled:r,handleHistoryClick:t}){return e.jsxs("div",{className:"flex items-center justify-end gap-2 p-1.5",children:[e.jsxs("button",{type:"button",onClick:t,title:"Xem lịch sử",className:"group flex items-center gap-1 transition-all justify-center rounded border border-gray-300 hover:border-sky-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-sky-900",children:[e.jsx(g,{iconName:"faClipboardList"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Lịch sử"})]}),e.jsxs("button",{type:"button",className:`${s.length>0?"opacity-100":"opacity-0 pointer-events-none"} group flex items-center gap-1 transition-all rounded border border-gray-300 hover:border-red-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-red-900`,onClick:a,children:[e.jsx(g,{iconName:"faEraser"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Xóa"})]}),e.jsxs("button",{type:"button",onClick:n,disabled:r,className:`rounded group flex items-center gap-1 border border-gray-300 px-3 py-1.5 text-sm font-medium shadow-sm transition-colors hover:bg-gray-100 ${r?"opacity-50 cursor-not-allowed text-gray-900":"cursor-pointer text-sky-600"}`,children:[e.jsx(g,{iconName:"faPaperPlane"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Dịch"})]})]})}function X({text:s,handleChange:a}){return e.jsx("textarea",{id:"Notes",className:"w-full resize-none border-none focus:ring-0 sm:text-sm outline-none h-full px-3 py-2",placeholder:"Ví dụ : Tiếng nhật khó nhưng thú vị.",value:s,onChange:a})}function M({options:s,onOptionChange:a}){const n=r=>{a({...s,theLoaiGiaoTiep:r.target.value})};return e.jsx("div",{className:"w-full p-2",children:e.jsxs("label",{htmlFor:"theLoaiGiaoTiep",className:"cursor-pointer w-full",children:[e.jsx("div",{className:"text-sm font-medium border-b w-full text-gray-700 dark:text-gray-200",children:e.jsx("p",{children:"Thể loại giao tiếp"})}),e.jsxs("select",{onChange:n,name:"theLoaiGiaoTiep",id:"theLoaiGiaoTiep",value:(s==null?void 0:s.theLoaiGiaoTiep)||"lịch sự",className:"mt-0.5 p-1 w-full rounded-b-xl border border-gray-300 shadow-sm outline-none text-sm dark:border-gray-600 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"lịch sự",children:"Lịch sự"}),e.jsx("option",{value:"thông thường",children:"Thông thường"}),e.jsx("option",{value:"suồng sã",children:"Suồng sã"}),e.jsx("option",{value:"cục súc",children:"Cục súc"}),e.jsx("option",{value:"nói với cấp trên",children:"Nói với cấp trên"}),e.jsx("option",{value:"nói với cấp dưới",children:"Nói với cấp dưới"}),e.jsx("option",{value:"nói với đồng nghiệp",children:"Nói với đồng nghiệp"})]})]})})}function U(){const{options:s,inputText:a,setInputText:n,setOptions:r}=l.useContext(k),[t,c]=l.useState(""),[i,o]=l.useState(!1);l.useEffect(()=>{c(a)},[a]),l.useEffect(()=>{const x=f=>{if(!f.ctrlKey)return;const d=f.key.toLowerCase();if(d==="enter"){f.preventDefault(),m();return}if(d==="h"){f.preventDefault(),h();return}if(d==="x"){f.preventDefault(),p();return}};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[t,a]);const u=x=>{c(x.target.value)},m=()=>{t.length>0&&n(t)},p=()=>{window.confirm("Xoá toàn bộ nội dung của bạn?")&&(c(""),n(""))},h=()=>{o(!i)},N=x=>{window.confirm("Bạn có muốn sử dụng lại nội dung này?")&&(n(x.inputText),r(x.options),h())},b=t.length===0||t===a;return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("label",{htmlFor:"Notes",children:[e.jsxs("div",{className:"flex justify-start items-center gap-2",children:[e.jsx(g,{iconName:"faLanguage",className:"text-2xl text-sky-800"}),e.jsx("span",{className:"text-2xl font-bold",children:"Tôi muốn nói"})]}),e.jsxs("div",{className:"relative h-full flex flex-col mt-0.5 overflow-hidden rounded-2xl border border-gray-300 shadow-sm focus-within:ring focus-within:ring-green-600",children:[e.jsxs("div",{children:[e.jsx(X,{text:t,handleChange:u}),e.jsx(_,{text:t,handleErase:p,handleButtonClick:m,isSendDisabled:b,handleHistoryClick:h})]}),e.jsx(M,{options:s,onOptionChange:r})]})]}),e.jsxs("div",{className:"flex flex-col justify-start",children:[e.jsx("p",{className:"text-xs text-sky-500 mt-1 italic",children:"* Nội dung được dịch bằng AI"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 italic flex gap-2",children:["* Chức năng được phát triển bởi ",e.jsx("p",{className:"text-red-800",children:location.hostname})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 italic",children:"* Kết quả dịch sẽ được tự động lưu vào lịch sử nếu chưa tồn tại."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Phím tắt: Ctrl+Enter = Dịch · Ctrl+H = Lịch sử · Ctrl+X = Xóa · Ctrl+_ (tùy chỉnh)"})]}),i&&e.jsx($,{onClose:h,onRepeat:N})]})}const K=()=>{const{generateContent:s}=J();return{dichCachDoc:async(n,r)=>{const t=(r==null?void 0:r.theLoaiGiaoTiep)||"bình thường";if(!n||typeof n!="string")return{error:"Dữ liệu đầu vào không hợp lệ"};const c=`
        Role: JLPT Expert.
        Task: Translate & Analyze "${n}" (Style: ${t}).
        Output: JSON RAW (No Markdown).
        Schema:
        {
            "japanese": "Japanese translation",
            "romaji": "Romaji transliteration",
            "list_structure" : [
                {
                    "special_structure": "Tên cấu trúc",
                    "analysis": "Chi tiết cách sử dụng cấu trúc đó."
                }
            ]
        }`;try{const o=(await s(c)).replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(o)}catch(i){return console.error("Lỗi Gemini:",i),{original:n,japanese:"Lỗi: Máy chủ Google AI đang bảo trì. Thử lại sau 1-2 phút. @@",romaji:"",list_structure:[{special_structure:"",analysis:"T.T"}]}}}}},k=l.createContext({options:{},inputText:"",aiCallBack:"",isLoading:!1,error:null,setInputText:()=>{},setOptions:()=>{}});function ee(){const s=O(),{dichCachDoc:a}=K(),[n,r]=l.useState(""),[t,c]=l.useState(""),[i,o]=l.useState({theLoaiGiaoTiep:"lịch sự"}),[u,m]=l.useState(!1),[p,h]=l.useState(null);l.useEffect(()=>{window.scrollY&&window.scrollTo({top:0,behavior:"smooth"})},[]);const N=(b,x,f)=>{try{const d=localStorage.getItem("dichHistory")||"[]",y=JSON.parse(d).map(j=>JSON.parse(decodeURIComponent(atob(j))));if(y.some(j=>j.inputText===b&&JSON.stringify(j.options)===JSON.stringify(x))){console.log("Mục giống hệt đã tồn tại, không lưu.");return}const v={id:Date.now(),inputText:b,options:x,aiCallBack:f},w=y.findLastIndex(j=>j.inputText===b);w!==-1?(console.log(`Tìm thấy nhóm cho '${b}'. Chèn vào sau vị trí ${w}.`),y.splice(w+1,0,v)):y.push(v);const I=y.map(j=>{const H=JSON.stringify(j);return btoa(encodeURIComponent(H))});localStorage.setItem("dichHistory",JSON.stringify(I))}catch(d){console.error("Lỗi khi tự động lưu lịch sử:",d)}};return l.useEffect(()=>{if(!t){r(""),h(null),m(!1);return}const x=(()=>{try{const d=localStorage.getItem("dichHistory")||"[]",y=JSON.parse(d).find(C=>{const v=JSON.parse(decodeURIComponent(atob(C)));return v.inputText===t&&JSON.stringify(v.options)===JSON.stringify(i)});return y?JSON.parse(decodeURIComponent(atob(y))):null}catch{return null}})();if(x){console.log("Tìm thấy kết quả trong cache."),r(x.aiCallBack),m(!1),h(null);return}(async()=>{m(!0),h(null);try{const d=await a(t,i);N(t,i,d),r(d)}catch(d){d.response&&d.response.status===429&&alert("Bạn đã gửi quá nhiều yêu cầu. Vui lòng thử lại sau một lát."),h(d),r("")}finally{m(!1)}})()},[t,i]),e.jsx(k.Provider,{value:{options:i,inputText:t,aiCallBack:n,isLoading:u,error:p,setOptions:o,setInputText:c},children:e.jsxs("section",{className:"min-h-screen px-5 mb-5 xl:p-0",children:[e.jsx("div",{className:"mb-5",children:s}),e.jsx(E,{}),e.jsxs("div",{className:"w-full flex flex-col gap-10",children:[e.jsx(U,{}),e.jsx(V,{})]})]})})}export{k as DichContext,ee as default};
