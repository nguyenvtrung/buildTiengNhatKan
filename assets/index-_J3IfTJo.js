import{e as re,g as je,r as p,j as e,I as J,T as me,R as we}from"./index-C4nicHr7.js";import{u as Ne}from"./index-ftKGn0Ei.js";import{A as Se}from"./index-BKuK_rFk.js";import{u as Te}from"./Model-DAH11KDf.js";import{a as ke,b as Ce,c as Le,d as Re}from"./index-Celfe9Fj.js";import{G as Ee}from"./iconBase-DUfgrNbI.js";import{a as Ie}from"./index-C8Ni-2UW.js";import{B as se}from"./ButtonVoidText-TaozVjLM.js";import{L as de}from"./index-ChwNzXUp.js";import{L as Oe}from"./index-DxA30LXS.js";import"./Breadcrumbs-BiM1TXvc.js";function Me(n){return Ee({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M319.61 20.654c13.145 33.114 13.144 33.115-5.46 63.5 33.114-13.145 33.116-13.146 63.5 5.457-13.145-33.114-13.146-33.113 5.457-63.498-33.114 13.146-33.113 13.145-63.498-5.459zM113.024 38.021c-11.808 21.04-11.808 21.04-35.724 24.217 21.04 11.809 21.04 11.808 24.217 35.725 11.808-21.04 11.808-21.04 35.724-24.217-21.04-11.808-21.04-11.808-24.217-35.725zm76.55 56.184c-.952 50.588-.95 50.588-41.991 80.18 50.587.95 50.588.95 80.18 41.99.95-50.588.95-50.588 41.99-80.18-50.588-.95-50.588-.95-80.18-41.99zm191.177 55.885c-.046 24.127-.048 24.125-19.377 38.564 24.127.047 24.127.046 38.566 19.375.047-24.126.046-24.125 19.375-38.564-24.126-.047-24.125-.046-38.564-19.375zm-184.086 83.88c-1.191.024-2.36.07-3.492.134-18.591 1.064-41.868 8.416-77.445 22.556L76.012 433.582c78.487-20.734 132.97-21.909 170.99-4.615V247.71c-18.076-8.813-31.79-13.399-46.707-13.737a91.166 91.166 0 0 0-3.629-.002zm122.686 11.42c-2.916-.026-5.81.011-8.514.098-12.81.417-27.638 2.215-45.84 4.522V427.145c43.565-7.825 106.85-4.2 171.244 7.566l-39.78-177.197c-35.904-8.37-56.589-11.91-77.11-12.123zm2.289 16.95c18.889.204 36.852 2.768 53.707 5.02l4.437 16.523c-23.78-3.75-65.966-4.906-92.467-.98l-.636-17.805c11.959-2.154 23.625-2.88 34.959-2.758zm-250.483 4.658l-10.617 46.004h24.094l10.326-46.004H71.158zm345.881 0l39.742 177.031 2.239 9.973 22.591-.152-40.855-186.852h-23.717zm-78.857 57.82c16.993.026 33.67.791 49.146 2.223l3.524 17.174c-32.645-3.08-72.58-2.889-102.995 0l-.709-17.174c16.733-1.533 34.04-2.248 51.034-2.223zm-281.793 6.18l-6.924 30.004h24.394l6.735-30.004H56.389zm274.418 27.244c4.656.021 9.487.085 14.716.203l2.555 17.498c-19.97-.471-47.115.56-59.728 1.05l-.7-17.985c16.803-.493 29.189-.828 43.157-.766zm41.476.447c8.268.042 16.697.334 24.121.069l2.58 17.74c-8.653-.312-24.87-.83-32.064-.502l-2.807-17.234a257.25 257.25 0 0 1 8.17-.073zm-326.97 20.309l-17.985 77.928 25.035-.17 17.455-77.758H45.313zm303.164 11.848c19.608-.01 38.66.774 56.449 2.572l2.996 20.787c-34.305-4.244-85.755-7.697-119.1-3.244l-.14-17.922c20.02-1.379 40.186-2.183 59.795-2.193zm-166.606 44.05c-30.112.09-67.916 6.25-115.408 19.76l-7.22 2.053 187.759-1.27v-6.347c-16.236-9.206-37.42-14.278-65.13-14.196zm134.41 6.174c-19.63.067-37.112 1.439-51.283 4.182v10.064l177.594-1.203c-44.322-8.634-89.137-13.17-126.31-13.043zM26 475v18h460v-18H26z"},child:[]}]})(n)}var le={exports:{}},ge;function Ae(){return ge||(ge=1,function(n){var t=function(r){var o=Object.prototype,a=o.hasOwnProperty,h=Object.defineProperty||function(s,i,c){s[i]=c.value},l,u=typeof Symbol=="function"?Symbol:{},x=u.iterator||"@@iterator",w=u.asyncIterator||"@@asyncIterator",y=u.toStringTag||"@@toStringTag";function m(s,i,c){return Object.defineProperty(s,i,{value:c,enumerable:!0,configurable:!0,writable:!0}),s[i]}try{m({},"")}catch{m=function(i,c,g){return i[c]=g}}function G(s,i,c,g){var d=i&&i.prototype instanceof z?i:z,v=Object.create(d.prototype),B=new $(g||[]);return h(v,"_invoke",{value:P(s,c,B)}),v}r.wrap=G;function M(s,i,c){try{return{type:"normal",arg:s.call(i,c)}}catch(g){return{type:"throw",arg:g}}}var R="suspendedStart",E="suspendedYield",N="executing",A="completed",S={};function z(){}function I(){}function f(){}var T={};m(T,x,function(){return this});var C=Object.getPrototypeOf,j=C&&C(C(q([])));j&&j!==o&&a.call(j,x)&&(T=j);var k=f.prototype=z.prototype=Object.create(T);I.prototype=f,h(k,"constructor",{value:f,configurable:!0}),h(f,"constructor",{value:I,configurable:!0}),I.displayName=m(f,y,"GeneratorFunction");function H(s){["next","throw","return"].forEach(function(i){m(s,i,function(c){return this._invoke(i,c)})})}r.isGeneratorFunction=function(s){var i=typeof s=="function"&&s.constructor;return i?i===I||(i.displayName||i.name)==="GeneratorFunction":!1},r.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,f):(s.__proto__=f,m(s,y,"GeneratorFunction")),s.prototype=Object.create(k),s},r.awrap=function(s){return{__await:s}};function O(s,i){function c(v,B,D,b){var L=M(s[v],s,B);if(L.type==="throw")b(L.arg);else{var W=L.arg,K=W.value;return K&&typeof K=="object"&&a.call(K,"__await")?i.resolve(K.__await).then(function(Y){c("next",Y,D,b)},function(Y){c("throw",Y,D,b)}):i.resolve(K).then(function(Y){W.value=Y,D(W)},function(Y){return c("throw",Y,D,b)})}}var g;function d(v,B){function D(){return new i(function(b,L){c(v,B,b,L)})}return g=g?g.then(D,D):D()}h(this,"_invoke",{value:d})}H(O.prototype),m(O.prototype,w,function(){return this}),r.AsyncIterator=O,r.async=function(s,i,c,g,d){d===void 0&&(d=Promise);var v=new O(G(s,i,c,g),d);return r.isGeneratorFunction(i)?v:v.next().then(function(B){return B.done?B.value:v.next()})};function P(s,i,c){var g=R;return function(v,B){if(g===N)throw new Error("Generator is already running");if(g===A){if(v==="throw")throw B;return V()}for(c.method=v,c.arg=B;;){var D=c.delegate;if(D){var b=_(D,c);if(b){if(b===S)continue;return b}}if(c.method==="next")c.sent=c._sent=c.arg;else if(c.method==="throw"){if(g===R)throw g=A,c.arg;c.dispatchException(c.arg)}else c.method==="return"&&c.abrupt("return",c.arg);g=N;var L=M(s,i,c);if(L.type==="normal"){if(g=c.done?A:E,L.arg===S)continue;return{value:L.arg,done:c.done}}else L.type==="throw"&&(g=A,c.method="throw",c.arg=L.arg)}}}function _(s,i){var c=i.method,g=s.iterator[c];if(g===l)return i.delegate=null,c==="throw"&&s.iterator.return&&(i.method="return",i.arg=l,_(s,i),i.method==="throw")||c!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+c+"' method")),S;var d=M(g,s.iterator,i.arg);if(d.type==="throw")return i.method="throw",i.arg=d.arg,i.delegate=null,S;var v=d.arg;if(!v)return i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,S;if(v.done)i[s.resultName]=v.value,i.next=s.nextLoc,i.method!=="return"&&(i.method="next",i.arg=l);else return v;return i.delegate=null,S}H(k),m(k,y,"Generator"),m(k,x,function(){return this}),m(k,"toString",function(){return"[object Generator]"});function F(s){var i={tryLoc:s[0]};1 in s&&(i.catchLoc=s[1]),2 in s&&(i.finallyLoc=s[2],i.afterLoc=s[3]),this.tryEntries.push(i)}function X(s){var i=s.completion||{};i.type="normal",delete i.arg,s.completion=i}function $(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(F,this),this.reset(!0)}r.keys=function(s){var i=Object(s),c=[];for(var g in i)c.push(g);return c.reverse(),function d(){for(;c.length;){var v=c.pop();if(v in i)return d.value=v,d.done=!1,d}return d.done=!0,d}};function q(s){if(s!=null){var i=s[x];if(i)return i.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var c=-1,g=function d(){for(;++c<s.length;)if(a.call(s,c))return d.value=s[c],d.done=!1,d;return d.value=l,d.done=!0,d};return g.next=g}}throw new TypeError(typeof s+" is not iterable")}r.values=q;function V(){return{value:l,done:!0}}return $.prototype={constructor:$,reset:function(s){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(X),!s)for(var i in this)i.charAt(0)==="t"&&a.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=l)},stop:function(){this.done=!0;var s=this.tryEntries[0],i=s.completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(s){if(this.done)throw s;var i=this;function c(b,L){return v.type="throw",v.arg=s,i.next=b,L&&(i.method="next",i.arg=l),!!L}for(var g=this.tryEntries.length-1;g>=0;--g){var d=this.tryEntries[g],v=d.completion;if(d.tryLoc==="root")return c("end");if(d.tryLoc<=this.prev){var B=a.call(d,"catchLoc"),D=a.call(d,"finallyLoc");if(B&&D){if(this.prev<d.catchLoc)return c(d.catchLoc,!0);if(this.prev<d.finallyLoc)return c(d.finallyLoc)}else if(B){if(this.prev<d.catchLoc)return c(d.catchLoc,!0)}else if(D){if(this.prev<d.finallyLoc)return c(d.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(s,i){for(var c=this.tryEntries.length-1;c>=0;--c){var g=this.tryEntries[c];if(g.tryLoc<=this.prev&&a.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var d=g;break}}d&&(s==="break"||s==="continue")&&d.tryLoc<=i&&i<=d.finallyLoc&&(d=null);var v=d?d.completion:{};return v.type=s,v.arg=i,d?(this.method="next",this.next=d.finallyLoc,S):this.complete(v)},complete:function(s,i){if(s.type==="throw")throw s.arg;return s.type==="break"||s.type==="continue"?this.next=s.arg:s.type==="return"?(this.rval=this.arg=s.arg,this.method="return",this.next="end"):s.type==="normal"&&i&&(this.next=i),S},finish:function(s){for(var i=this.tryEntries.length-1;i>=0;--i){var c=this.tryEntries[i];if(c.finallyLoc===s)return this.complete(c.completion,c.afterLoc),X(c),S}},catch:function(s){for(var i=this.tryEntries.length-1;i>=0;--i){var c=this.tryEntries[i];if(c.tryLoc===s){var g=c.completion;if(g.type==="throw"){var d=g.arg;X(c)}return d}}throw new Error("illegal catch attempt")},delegateYield:function(s,i,c){return this.delegate={iterator:q(s),resultName:i,nextLoc:c},this.method==="next"&&(this.arg=l),S}},r}(n.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(le)),le.exports}Ae();function pe(n,t,r,o,a,h,l){try{var u=n[h](l),x=u.value}catch(w){r(w);return}u.done?t(x):Promise.resolve(x).then(o,a)}function Q(n){return function(){var t=this,r=arguments;return new Promise(function(o,a){var h=n.apply(t,r);function l(x){pe(h,o,a,l,u,"next",x)}function u(x){pe(h,o,a,l,u,"throw",x)}l(void 0)})}}var he,fe;function Pe(){if(fe)return he;fe=1;var n="Expected a function",t=NaN,r="[object Symbol]",o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt,x=typeof re=="object"&&re&&re.Object===Object&&re,w=typeof self=="object"&&self&&self.Object===Object&&self,y=x||w||Function("return this")(),m=Object.prototype,G=m.toString,M=Math.max,R=Math.min,E=function(){return y.Date.now()};function N(f,T,C){var j,k,H,O,P,_,F=0,X=!1,$=!1,q=!0;if(typeof f!="function")throw new TypeError(n);T=I(T)||0,A(C)&&(X=!!C.leading,$="maxWait"in C,H=$?M(I(C.maxWait)||0,T):H,q="trailing"in C?!!C.trailing:q);function V(b){var L=j,W=k;return j=k=void 0,F=b,O=f.apply(W,L),O}function s(b){return F=b,P=setTimeout(g,T),X?V(b):O}function i(b){var L=b-_,W=b-F,K=T-L;return $?R(K,H-W):K}function c(b){var L=b-_,W=b-F;return _===void 0||L>=T||L<0||$&&W>=H}function g(){var b=E();if(c(b))return d(b);P=setTimeout(g,i(b))}function d(b){return P=void 0,q&&j?V(b):(j=k=void 0,O)}function v(){P!==void 0&&clearTimeout(P),F=0,j=_=k=P=void 0}function B(){return P===void 0?O:d(E())}function D(){var b=E(),L=c(b);if(j=arguments,k=this,_=b,L){if(P===void 0)return s(_);if($)return P=setTimeout(g,T),V(_)}return P===void 0&&(P=setTimeout(g,T)),O}return D.cancel=v,D.flush=B,D}function A(f){var T=typeof f;return!!f&&(T=="object"||T=="function")}function S(f){return!!f&&typeof f=="object"}function z(f){return typeof f=="symbol"||S(f)&&G.call(f)==r}function I(f){if(typeof f=="number")return f;if(z(f))return t;if(A(f)){var T=typeof f.valueOf=="function"?f.valueOf():f;f=A(T)?T+"":T}if(typeof f!="string")return f===0?f:+f;f=f.replace(o,"");var C=h.test(f);return C||l.test(f)?u(f.slice(2),C?2:8):a.test(f)?t:+f}return he=N,he}var De=Pe();const _e=je(De),ee=typeof window<"u"&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition),Be=n=>n===ee;var ae=()=>/(android)/i.test(typeof navigator<"u"?navigator.userAgent:"");const oe=(...n)=>n.map(t=>t.trim()).join(" ").trim(),Ge=/\s*\((.*?)\)\s*/g,ze=/(\(\?:[^)]+\))\?/g,He=/(\(\?)?:\w+/g,$e=/\*/g,Je=/[-{}[\]+?.,\\^$|#]/g,Ve=n=>n instanceof RegExp?new RegExp(n.source,"i"):(n=n.replace(Je,"\\$&").replace(Ge,"(?:$1)?").replace(He,(t,r)=>r?t:"([^\\s]+)").replace($e,"(.*?)").replace(ze,"\\s*$1?\\s*"),new RegExp("^"+n+"$","i")),Fe=(n,t)=>{if(n=n.replace(/\s+/g,"").toLowerCase(),t=t.replace(/\s+/g,"").toLowerCase(),!n.length&&!t.length)return 1;if(!n.length||!t.length)return 0;if(n===t)return 1;if(n.length===1&&t.length===1||n.length<2||t.length<2)return 0;const r=new Map;for(let a=0;a<n.length-1;a++){const h=n.substring(a,a+2),l=r.has(h)?r.get(h)+1:1;r.set(h,l)}let o=0;for(let a=0;a<t.length-1;a++){const h=t.substring(a,a+2),l=r.has(h)?r.get(h):0;l>0&&(r.set(h,l-1),o++)}return 2*o/(n.length+t.length-2)},xe=()=>typeof window<"u"&&window.navigator!==void 0&&window.navigator.mediaDevices!==void 0&&window.navigator.mediaDevices.getUserMedia!==void 0&&(window.AudioContext!==void 0||window.webkitAudioContext!==void 0);class ue{setSpeechRecognition(t){const r=!!t&&(Be(t)||xe());r&&(this.disableRecognition(),this.recognition=new t,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onresult=this.updateTranscript.bind(this),this.recognition.onend=this.onRecognitionDisconnect.bind(this),this.recognition.onerror=this.onError.bind(this)),this.emitBrowserSupportsSpeechRecognitionChange(r)}subscribe(t,r){this.subscribers[t]=r}unsubscribe(t){delete this.subscribers[t]}emitListeningChange(t){this.listening=t,Object.keys(this.subscribers).forEach(r=>{const{onListeningChange:o}=this.subscribers[r];o(t)})}emitMicrophoneAvailabilityChange(t){this.isMicrophoneAvailable=t,Object.keys(this.subscribers).forEach(r=>{const{onMicrophoneAvailabilityChange:o}=this.subscribers[r];o(t)})}emitTranscriptChange(t,r){Object.keys(this.subscribers).forEach(o=>{const{onTranscriptChange:a}=this.subscribers[o];a(t,r)})}emitClearTranscript(){Object.keys(this.subscribers).forEach(t=>{const{onClearTranscript:r}=this.subscribers[t];r()})}emitBrowserSupportsSpeechRecognitionChange(t){Object.keys(this.subscribers).forEach(r=>{const{onBrowserSupportsSpeechRecognitionChange:o,onBrowserSupportsContinuousListeningChange:a}=this.subscribers[r];o(t),a(t)})}disconnect(t){if(this.recognition&&this.listening)switch(t){case"ABORT":this.pauseAfterDisconnect=!0,this.abort();break;case"RESET":this.pauseAfterDisconnect=!1,this.abort();break;case"STOP":default:this.pauseAfterDisconnect=!0,this.stop()}}disableRecognition(){this.recognition&&(this.recognition.onresult=()=>{},this.recognition.onend=()=>{},this.recognition.onerror=()=>{},this.listening&&this.stopListening())}onError(t){t&&t.error&&t.error==="not-allowed"&&(this.emitMicrophoneAvailabilityChange(!1),this.disableRecognition())}onRecognitionDisconnect(){this.onStopListening(),this.listening=!1,this.pauseAfterDisconnect?this.emitListeningChange(!1):this.recognition&&(this.recognition.continuous?this.startListening({continuous:this.recognition.continuous}):this.emitListeningChange(!1)),this.pauseAfterDisconnect=!1}updateTranscript({results:t,resultIndex:r}){const o=r===void 0?t.length-1:r;this.interimTranscript="",this.finalTranscript="";for(let h=o;h<t.length;++h)t[h].isFinal&&(!ae()||t[h][0].confidence>0)?this.updateFinalTranscript(t[h][0].transcript):this.interimTranscript=oe(this.interimTranscript,t[h][0].transcript);let a=!1;this.interimTranscript===""&&this.finalTranscript!==""?(this.previousResultWasFinalOnly&&(a=!0),this.previousResultWasFinalOnly=!0):this.previousResultWasFinalOnly=!1,a||this.emitTranscriptChange(this.interimTranscript,this.finalTranscript)}updateFinalTranscript(t){this.finalTranscript=oe(this.finalTranscript,t)}resetTranscript(){this.disconnect("RESET")}startListening(){return Q(function*({continuous:t=!1,language:r}={}){if(!this.recognition)return;const o=t!==this.recognition.continuous,a=r&&r!==this.recognition.lang;if((o||a)&&(this.listening&&(yield this.stopListening()),this.recognition.continuous=o?t:this.recognition.continuous,this.recognition.lang=a?r:this.recognition.lang),!this.listening){this.recognition.continuous||(this.resetTranscript(),this.emitClearTranscript());try{yield this.start(),this.emitListeningChange(!0)}catch(h){h instanceof DOMException||this.emitMicrophoneAvailabilityChange(!1)}}}).apply(this,arguments)}abortListening(){return Q(function*(){this.disconnect("ABORT"),this.emitListeningChange(!1),yield new Promise(t=>{this.onStopListening=t})}).call(this)}stopListening(){return Q(function*(){this.disconnect("STOP"),this.emitListeningChange(!1),yield new Promise(t=>{this.onStopListening=t})}).call(this)}getRecognition(){return this.recognition}start(){return Q(function*(){this.recognition&&!this.listening&&(yield this.recognition.start(),this.listening=!0)}).call(this)}stop(){this.recognition&&this.listening&&(this.recognition.stop(),this.listening=!1)}abort(){this.recognition&&this.listening&&(this.recognition.abort(),this.listening=!1)}constructor(t){this.recognition=null,this.pauseAfterDisconnect=!1,this.interimTranscript="",this.finalTranscript="",this.listening=!1,this.isMicrophoneAvailable=!0,this.subscribers={},this.onStopListening=()=>{},this.previousResultWasFinalOnly=!1,this.resetTranscript=this.resetTranscript.bind(this),this.startListening=this.startListening.bind(this),this.stopListening=this.stopListening.bind(this),this.abortListening=this.abortListening.bind(this),this.setSpeechRecognition=this.setSpeechRecognition.bind(this),this.disableRecognition=this.disableRecognition.bind(this),this.setSpeechRecognition(t),ae()&&(this.updateFinalTranscript=_e(this.updateFinalTranscript,250,{leading:!0}))}}const ye="CLEAR_TRANSCRIPT",be="APPEND_TRANSCRIPT",We=()=>({type:ye}),Ue=(n,t)=>({type:be,payload:{interimTranscript:n,finalTranscript:t}}),Xe=(n,t)=>{switch(t.type){case ye:return{interimTranscript:"",finalTranscript:""};case be:return{interimTranscript:t.payload.interimTranscript,finalTranscript:oe(n.finalTranscript,t.payload.finalTranscript)};default:throw new Error}};let te=!!ee,ie=te&&!ae(),U;const qe=({transcribing:n=!0,clearTranscriptOnListen:t=!0,commands:r=[]}={})=>{const[o]=p.useState(Z.getRecognitionManager()),[a,h]=p.useState(te),[l,u]=p.useState(ie),[{interimTranscript:x,finalTranscript:w},y]=p.useReducer(Xe,{interimTranscript:o.interimTranscript,finalTranscript:""}),[m,G]=p.useState(o.listening),[M,R]=p.useState(o.isMicrophoneAvailable),E=p.useRef(r);E.current=r;const N=()=>{y(We())},A=p.useCallback(()=>{o.resetTranscript(),N()},[o]),S=(j,k,H)=>{const P=(typeof j=="object"?j.toString():j).replace(/[&/\\#,+()!$~%.'":*?<>{}]/g,"").replace(/  +/g," ").trim(),_=Fe(P,k);return _>=H?{command:j,commandWithoutSpecials:P,howSimilar:_,isFuzzyMatch:!0}:null},z=(j,k)=>{const O=Ve(j).exec(k);return O?{command:j,parameters:O.slice(1)}:null},I=p.useCallback((j,k)=>{E.current.forEach(({command:H,callback:O,matchInterim:P=!1,isFuzzyMatch:_=!1,fuzzyMatchingThreshold:F=.8,bestMatchOnly:X=!1})=>{const $=!k&&P?j.trim():k.trim(),V=(Array.isArray(H)?H:[H]).map(s=>_?S(s,$,F):z(s,$)).filter(s=>s);if(_&&X&&V.length>=2){V.sort((g,d)=>d.howSimilar-g.howSimilar);const{command:s,commandWithoutSpecials:i,howSimilar:c}=V[0];O(i,$,c,{command:s,resetTranscript:A})}else V.forEach(s=>{if(s.isFuzzyMatch){const{command:i,commandWithoutSpecials:c,howSimilar:g}=s;O(c,$,g,{command:i,resetTranscript:A})}else{const{command:i,parameters:c}=s;O(...c,{command:i,resetTranscript:A})}})})},[A]),f=p.useCallback((j,k)=>{n&&y(Ue(j,k)),I(j,k)},[I,n]),T=p.useCallback(()=>{t&&N()},[t]);return p.useEffect(()=>{const j=Z.counter;Z.counter+=1;const k={onListeningChange:G,onMicrophoneAvailabilityChange:R,onTranscriptChange:f,onClearTranscript:T,onBrowserSupportsSpeechRecognitionChange:h,onBrowserSupportsContinuousListeningChange:u};return o.subscribe(j,k),()=>{o.unsubscribe(j)}},[n,t,o,f,T]),{transcript:oe(w,x),interimTranscript:x,finalTranscript:w,listening:m,isMicrophoneAvailable:M,resetTranscript:A,browserSupportsSpeechRecognition:a,browserSupportsContinuousListening:l}},Z={counter:0,applyPolyfill:n=>{U?U.setSpeechRecognition(n):U=new ue(n);const t=!!n&&xe();te=t,ie=t},removePolyfill:()=>{U?U.setSpeechRecognition(ee):U=new ue(ee),te=!!ee,ie=te&&!ae()},getRecognitionManager:()=>(U||(U=new ue(ee)),U),getRecognition:()=>Z.getRecognitionManager().getRecognition(),startListening:({continuous:n,language:t}={})=>Q(function*(){yield Z.getRecognitionManager().startListening({continuous:n,language:t})})(),stopListening:()=>Q(function*(){yield Z.getRecognitionManager().stopListening()})(),abortListening:()=>Q(function*(){yield Z.getRecognitionManager().abortListening()})(),browserSupportsSpeechRecognition:()=>te,browserSupportsContinuousListening:()=>ie},Ke=/[.,\/#!$%\^&\*;:{}=\-_`~()。、！？\s]/,ce=n=>n?n.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()。、！？]/g,"").replace(/\s+/g,""):"",Ye=(n,t)=>{const r=ce(n),o=ce(t);if(!r||!o)return new Set;const a=r.length,h=o.length,l=Array.from(Array(a+1),()=>Array(h+1).fill(0));for(let y=1;y<=a;y++)for(let m=1;m<=h;m++)r[y-1]===o[m-1]?l[y][m]=l[y-1][m-1]+1:l[y][m]=Math.max(l[y-1][m],l[y][m-1]);let u=a,x=h;const w=new Set;for(;u>0&&x>0;)r[u-1]===o[x-1]?(w.add(x-1),u--,x--):l[u-1][x]>l[u][x-1]?u--:x--;return w},Qe=(n,t)=>{const r=new Set;let o=0;for(let a=0;a<t.length;a++){const h=t[a];Ke.test(h)||(n.has(o)&&r.add(a),o++)}return r},Ze=(n,t="ja-JP")=>{const[r,o]=p.useState(0),[a,h]=p.useState(new Set),{transcript:l,listening:u,resetTranscript:x,browserSupportsSpeechRecognition:w,isMicrophoneAvailable:y}=qe(),m=()=>{o(0),h(new Set),x()},G=()=>{},M=(R=!1)=>{if(!l)return;const E=Ye(l,n),N=Qe(E,n);if(h(N),R){const A=ce(n),S=E.size,z=A.length;if(z===0)return;let I=S/z*100;ce(l).length>z*1.5&&(I*=.8),o(I>=90?100:Math.floor(I))}};return p.useEffect(()=>{u&&M(!1)},[l,u,n]),p.useEffect(()=>{!u&&l&&M(!0)},[u,l,n]),{transcript:l,listening:u,score:r,matchedIndices:a,startListening:m,stopListening:G,isSupported:w,hasMic:y}},et=p.memo(({text:n,matchedIndices:t})=>e.jsx("div",{className:"text-xl sm:text-2xl font-medium leading-relaxed flex flex-wrap gap-x-1 text-left",children:n.split("").map((r,o)=>e.jsx("span",{className:`transition-colors duration-200 ${t.has(o)?"text-green-600 font-bold":"text-gray-400"}`,children:r},o))})),tt=p.memo(({setStatus:n})=>e.jsx("div",{className:"flex items-center gap-1 cursor-pointer bg-gray-100 text-gray-600 hover:bg-gray-200 p-2 rounded-full transition-all",onClick:()=>n(!1),children:e.jsx(J,{iconName:"faClose"})})),nt=p.memo(({score:n})=>e.jsxs("div",{className:"w-full animate-in fade-in slide-in-from-bottom-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Độ chính xác"}),e.jsxs("span",{className:`text-lg font-black ${n>=80?"text-green-600":"text-orange-500"}`,children:[n,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-1000 ease-out ${n>=80?"bg-green-500":"bg-orange-500"}`,style:{width:`${n}%`}})})]})),rt=({value:n,language:t,setStatus:r})=>{const o=n||"こんにちは",a=t||"ja-JP";p.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]);const{transcript:h,listening:l,score:u,matchedIndices:x,startListening:w,stopListening:y,isSupported:m}=Ze(o,a);return m?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[100] p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white w-full max-w-lg max-h-[90vh] rounded-[24px] shadow-2xl flex flex-col overflow-hidden animate-in zoom-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-white z-10",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center gap-2 uppercase tracking-wide",children:[e.jsx(ke,{className:"text-blue-500 text-xl"})," Luyện nói"]}),e.jsx(tt,{setStatus:r})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar",children:[e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 border border-gray-100 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("span",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest bg-blue-50 px-2 py-1 rounded",children:"Nội dung"}),e.jsx(se,{text:o,language:a})]}),e.jsx("div",{className:"break-words",children:e.jsx(et,{text:o,matchedIndices:x})})]}),(h||u>0)&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-4 shadow-sm animate-in fade-in",children:[e.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase mb-1",children:"Bạn đã nói"}),e.jsx("p",{className:"text-gray-600 italic text-sm mb-2 break-words",children:h?`"${h}"`:"..."}),!l&&u>0&&e.jsx(nt,{score:u})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-100 bg-white flex flex-col items-center z-10",children:[e.jsxs("div",{className:"relative group",children:[l&&e.jsx("div",{className:"absolute inset-0 bg-red-400 rounded-full animate-ping opacity-20 scale-150"}),e.jsx("button",{onMouseDown:w,onMouseUp:y,onMouseLeave:y,onTouchStart:w,onTouchEnd:y,className:`relative z-10 w-20 h-20 rounded-full flex items-center justify-center transition-all duration-300 shadow-xl select-none touch-none ${l?"bg-red-500 scale-110 shadow-red-200":"bg-gradient-to-br from-blue-500 to-blue-600 hover:scale-105 shadow-blue-200 active:scale-95"}`,children:l?e.jsx(Ce,{size:36,className:"text-white"}):e.jsx(Le,{size:32,className:"text-white"})})]}),e.jsx("p",{className:`mt-3 text-xs font-bold tracking-wide uppercase ${l?"text-red-500 animate-pulse":"text-gray-400"}`,children:l?"Đang thu âm...":"Nhấn giữ để nói"})]})]})}):null};function ve({value:n,language:t}){const[r,o]=p.useState(!1);return e.jsxs("div",{children:[e.jsx(me,{title:r?"Tắt đọc":"Đọc",className:"cursor-pointer mt-1 p-1 rounded-full shadow shadow-gray-800",onClick:()=>{o(!r)},children:e.jsx(J,{iconName:r?"faMicrophoneLinesSlash":"faMicrophoneLines",className:`${r?"bg-sky-500 text-white":""} transition-all aspect-1/1  text-gray-800 dark:text-white`})}),r&&e.jsx(rt,{value:n,language:t,setStatus:o})]})}const it=p.memo(({title:n})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:n}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]}));function st({title:n}){const{inputText:t,aiCallBack:r,isLoading:o,error:a}=p.useContext(ne),{romaji:h,japanese:l}=r||{},u=()=>o?e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(de,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}):a?e.jsxs("p",{className:"text-red-500",children:["Lỗi: ",a.message||"Đã có lỗi xảy ra"]}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Nội dung:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(se,{text:t,language:"vi-VN"}),e.jsx("p",{children:t})]})]}),l&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Dịch:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(se,{text:l,language:"ja-JP"}),e.jsx(ve,{value:l,language:"ja-JP"}),e.jsx("p",{children:l})]})]}),h&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800 italic text-sm",children:"Cách đọc:"}),e.jsx("p",{children:h})]})]}):e.jsx("p",{children:"Vui lòng nhập nội dung cần dịch."});return e.jsxs("div",{className:"w-full shadow shadow-gray-400  rounded-b-2xl p-5 ",children:[e.jsx(it,{title:n||"Dịch - Cách đọc"}),u()]})}const at=p.memo(({title:n})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:n}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]})),ot=p.memo(({item:n})=>{const{special_structure:t,html:r,analysis:o}=n||{},a=l=>l?l.replace(/Aい/g,"A<sub>い</sub><sub class='text-gray-800 italic'>( Tính từ đuôi い)</sub>").replace(/Aな/g,"A<sub>な</sub><sub class='text-gray-800 italic'>( Tính từ đuôi な)</sub>").replace(/V(る|て|た|ない)/g,"V<sub>$1</sub>").replace("V-masu","V<sub>ます</sub>").replace("N/Na-adj","N<sub class='text-gray-800 italic'>( Danh từ )</sub>").replace(/\*\*(.*?)\*\*/g,"<br><b>$1</b><br>"):"",h=p.useMemo(()=>a(String(t)||""),[t]);return e.jsx(me,{title:`Chi tiết cấu trúc:${t}`||"",placement:"top",arrow:!0,children:e.jsxs("details",{className:"group cursor-pointer p-3 border-b last:border-0 border-gray-100 dark:border-gray-700",children:[e.jsx("summary",{className:"flex items-center justify-between list-none outline-none",children:e.jsx("div",{className:"text-sky-800 dark:text-sky-400 font-bold text-lg hover:text-sky-600 transition-colors",dangerouslySetInnerHTML:{__html:h}})}),e.jsx("div",{className:"grid grid-rows-[0fr] transition-all duration-300 ease-in-out group-open:grid-rows-[1fr]",children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"pt-3 pl-4 border-l-2 border-gray-200 dark:border-gray-600 ml-1 mt-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic",children:o})})})})]})})});function ct({title:n}){const{aiCallBack:t,isLoading:r,error:o}=p.useContext(ne),{list_structure:a}=t||{};return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-b-2xl p-5 ",children:[e.jsx(at,{title:n||"Phân tích"}),r&&e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(de,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}),(a==null?void 0:a.length)>0&&!r&&e.jsx("div",{className:"mt-2",children:e.jsx("ul",{className:" list-inside flex  flex-col gap-5",children:a.map((h,l)=>e.jsx("li",{className:"shadow shadow-gray-400 p-2 rounded-2xl",children:e.jsx(ot,{item:h})},l))})}),!r&&(!a||a.length===0)&&e.jsx("p",{className:"text-center text-gray-400 mt-4 text-sm",children:"Không tìm thấy cấu trúc ngữ pháp đặc biệt."})]})}const lt=p.memo(({title:n})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:n}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]})),ht=p.memo(({item:n})=>e.jsxs("li",{className:"w-full h-full shadow shadow-gray-400 p-2 rounded-2xl bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsxs("div",{className:"flex gap-2 items-center text-xl text-sky-800 dark:text-sky-200",children:[e.jsx(Oe,{}),e.jsx("span",{className:"font-Japan font-bold",children:n==null?void 0:n.word})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{text:n==null?void 0:n.word,language:"ja-JP"}),e.jsx(ve,{value:n==null?void 0:n.word,language:"ja-JP"})]})]}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-xl p-2 mt-2",children:e.jsx("p",{className:"text-sm lg:text-base",children:n==null?void 0:n.meaning})})]}));function ut({title:n}){const{aiCallBack:t,isLoading:r,error:o}=p.useContext(ne),{list_vocabulary:a}=t||{};return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-b-2xl p-5 ",children:[e.jsx(lt,{title:n||"Phân tích"}),r&&e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(de,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}),(a==null?void 0:a.length)>0&&!r&&e.jsx("div",{className:"mt-2",children:e.jsx("ul",{className:" grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-5",children:a.map((h,l)=>{const u=h!=null&&h.word?`${h.word}-${l}`:l;return e.jsx(ht,{item:h},u)})})}),!r&&(!a||a.length===0)&&e.jsx("p",{className:"text-center text-gray-400 mt-4 text-sm",children:"Không tìm thấy từ vựng đặc biệt."})]})}const dt=p.memo(ut);function gt({aiCallBack:n}){const[t,r]=we.useState("tab1");p.useEffect(()=>{n&&r("tab1")},[n]);const o=(a,h)=>"dark:text-white flex-1 text-center py-1  px-4 flex items-center justify-center gap-2 text-lg font-medium border-b-4 transition-all duration-300 "+(h===a?"border-indigo-700 text-indigo-800":"border-transparent text-gray-600  hover:text-gray-800 hover:border-gray-300 dark:hover:text-white");return e.jsxs("section",{children:[e.jsxs("nav",{className:"flex justify-between bg-white dark:bg-gray-800  border-b border-gray-200 rounded-t-lg",children:[e.jsxs("button",{onClick:()=>r("tab1"),className:o("tab1",t),children:[e.jsx(Re,{className:"text-xl"}),e.jsx("span",{className:"hidden md:block",children:"Dịch - cách đọc"})]}),e.jsxs("button",{onClick:()=>r("tab2"),className:o("tab2",t),children:[e.jsx(Me,{className:"text-xl"}),e.jsx("span",{className:"hidden md:block",children:"Phân tích cấu trúc"})]}),e.jsxs("button",{onClick:()=>r("tab3"),className:o("tab3",t),children:[e.jsx(Ie,{className:"text-xl"}),e.jsx("span",{className:"hidden md:block",children:"Danh sách từ vựng"})]})]}),e.jsxs("div",{className:"",children:[t==="tab1"&&e.jsx(st,{title:"Dịch"}),t==="tab2"&&e.jsx(ct,{title:"Cấu trúc"}),t==="tab3"&&e.jsx(dt,{title:"Từ vựng"})]})]})}function pt(){const{aiCallBack:n,isLoading:t}=p.useContext(ne);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col  md:flex-row justify-between gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{iconName:"faCrown",className:"text-2xl text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Phân tích"})]}),e.jsx("h5",{className:"text-gray-400 text-sm italic",children:location.href})]}),e.jsx("div",{className:"flex flex-col gap-5 select-text mt-2",children:e.jsx(gt,{aiCallBack:n})})]})}function ft({onClose:n,onRepeat:t}){const[r,o]=p.useState([]),a=()=>{try{const u=localStorage.getItem("dichHistory");if(u){const w=JSON.parse(u).map(y=>{const m=atob(y),G=decodeURIComponent(m);return JSON.parse(G)});o(w)}else o([])}catch(u){console.error("Failed to load history from localStorage:",u),localStorage.removeItem("dichHistory"),o([])}};p.useEffect(()=>{a()},[]);const h=()=>{window.confirm("Bạn có chắc chắn muốn xóa TOÀN BỘ lịch sử dịch? Thao tác này không thể hoàn tác.")&&(localStorage.removeItem("dichHistory"),o([]))},l=u=>{if(window.confirm("Bạn có chắc chắn muốn xóa mục này?")){const x=r.filter(y=>y.id!==u),w=x.map(y=>{const m=JSON.stringify(y);return btoa(encodeURIComponent(m))});localStorage.setItem("dichHistory",JSON.stringify(w)),o(x)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 flex justify-center items-center",onClick:n,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-[90%] max-w-2xl max-h-[80vh] flex flex-col",onClick:u=>u.stopPropagation(),children:[e.jsxs("header",{className:"flex flex-wrap justify-between items-center p-4 border-b dark:border-gray-600",children:[e.jsxs("h2",{className:"text-xl font-bold text-sky-800 dark:text-sky-400",children:[e.jsx(J,{iconName:"faClipboardList",className:"mr-2"}),"Lịch sử đã lưu"]}),e.jsxs("div",{className:"flex items-center justify-end  gap-4",children:[r.length>0&&e.jsxs("button",{onClick:h,title:"Xóa toàn bộ lịch sử",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(J,{iconName:"faTrashCan"}),e.jsx("span",{children:"Xóa tất cả"})]}),e.jsx("button",{onClick:n,className:"text-gray-600 border border-gray-300 px-3 py-1.5 text-sm font-medium rounded-md hover:text-red-800 dark:text-gray-300 dark:hover:text-white",children:"Đóng"})]})]}),e.jsx("main",{className:"p-5 overflow-y-auto",children:r.length>0?e.jsx("ul",{className:"space-y-3",children:r.slice().reverse().map(u=>{var x;return e.jsxs("li",{className:"flex flex-col gap-2 md:flex-row justify-between w-full  items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"w-full md:w-fit flex items-center justify-between px-2 gap-2 md:border-r md:pr-2 mr-4",children:[e.jsx("button",{onClick:()=>t(u),title:"Dùng lại",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-sky-700 hover:text-sky-900 dark:text-sky-400 dark:hover:text-sky-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:e.jsx(J,{iconName:"faRepeat"})}),e.jsx("button",{onClick:()=>l(u.id),title:"Xóa mục này",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:e.jsx(J,{iconName:"faTrashCan"})})]}),e.jsxs("div",{className:"w-full overflow-hidden px-2 mr-4",children:[e.jsx("p",{className:"text-gray-800 dark:text-gray-200 truncate",title:u.inputText,children:u.inputText}),e.jsxs("div",{className:" flex gap-2 text-xs italic text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("p",{children:"Phong cách : "}),e.jsx("p",{children:((x=u.options)==null?void 0:x.theLoaiGiaoTiep)||"không rõ"})]})]})]},u.id)})}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Chưa có lịch sử nào được lưu."})})]})})}function mt({text:n,handleErase:t,handleButtonClick:r,isSendDisabled:o,handleHistoryClick:a}){return e.jsxs("div",{className:"flex items-center justify-end gap-2 p-1.5 ",children:[e.jsxs("button",{type:"button",onClick:a,title:"Xem lịch sử",className:"dark:text-white group flex items-center gap-1 transition-all justify-center rounded border border-gray-300 hover:border-sky-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-sky-900",children:[e.jsx(J,{iconName:"faClipboardList"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Lịch sử"})]}),e.jsxs("button",{type:"button",className:`${n.length>0?"opacity-100":"opacity-0 pointer-events-none"} dark:text-white group flex items-center gap-1 transition-all rounded border border-gray-300 hover:border-red-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-red-900`,onClick:t,children:[e.jsx(J,{iconName:"faEraser"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Xóa"})]}),e.jsxs("button",{type:"button",onClick:r,disabled:o,className:`dark:text-white rounded group flex items-center gap-1 border border-gray-300 px-3 py-1.5 text-sm font-medium shadow-sm transition-colors hover:bg-gray-100 ${o?"opacity-50 cursor-not-allowed text-gray-900":"cursor-pointer text-sky-600"}`,children:[e.jsx(J,{iconName:"faPaperPlane"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Dịch"})]})]})}function xt({text:n,handleChange:t}){return e.jsx("textarea",{id:"Notes",className:"w-full resize-none border-none focus:ring-0 sm:text-sm outline-none h-full px-3 py-2",placeholder:"Ví dụ : Tiếng nhật khó nhưng thú vị.",value:n,onChange:t})}function yt({options:n,onOptionChange:t}){const r=o=>{t({...n,theLoaiGiaoTiep:o.target.value})};return e.jsx("div",{className:"w-full p-2",children:e.jsxs("label",{htmlFor:"theLoaiGiaoTiep",className:"cursor-pointer w-full",children:[e.jsx("div",{className:"text-sm font-medium border-b w-full text-gray-700 dark:text-gray-200",children:e.jsx("p",{children:"Thể loại giao tiếp"})}),e.jsxs("select",{onChange:r,name:"theLoaiGiaoTiep",id:"theLoaiGiaoTiep",value:(n==null?void 0:n.theLoaiGiaoTiep)||"lịch sự",className:"mt-0.5 p-1 w-full rounded-b-xl border border-gray-300 shadow-sm outline-none text-sm dark:border-gray-600 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"lịch sự",children:"Lịch sự"}),e.jsx("option",{value:"thông thường",children:"Thông thường"}),e.jsx("option",{value:"suồng sã",children:"Suồng sã"}),e.jsx("option",{value:"cục súc",children:"Cục súc"}),e.jsx("option",{value:"nói với cấp trên",children:"Nói với cấp trên"}),e.jsx("option",{value:"nói với cấp dưới",children:"Nói với cấp dưới"}),e.jsx("option",{value:"nói với đồng nghiệp",children:"Nói với đồng nghiệp"})]})]})})}function bt(){const{options:n,inputText:t,setInputText:r,setOptions:o}=p.useContext(ne),[a,h]=p.useState(""),[l,u]=p.useState(!1);p.useEffect(()=>{h(t)},[t]),p.useEffect(()=>{const R=E=>{if(!E.ctrlKey)return;const N=E.key.toLowerCase();if(N==="enter"){E.preventDefault(),w();return}if(N==="h"){E.preventDefault(),m();return}if(N==="x"){E.preventDefault(),y();return}};return document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)},[a,t]);const x=R=>{h(R.target.value)},w=()=>{a.length>0&&r(a)},y=()=>{window.confirm("Xoá toàn bộ nội dung của bạn?")&&(h(""),r(""))},m=()=>{u(!l)},G=R=>{window.confirm("Bạn có muốn sử dụng lại nội dung này?")&&(r(R.inputText),o(R.options),m())},M=a.length===0||a===t;return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("label",{htmlFor:"Notes",children:[e.jsxs("div",{className:"flex justify-start items-center gap-2",children:[e.jsx(J,{iconName:"faLanguage",className:"text-2xl text-sky-800"}),e.jsx("span",{className:"text-2xl font-bold",children:"Tôi muốn nói"})]}),e.jsxs("div",{className:"relative h-full flex flex-col mt-0.5 overflow-hidden rounded-2xl border border-gray-300 shadow-sm focus-within:ring focus-within:ring-green-600 ",children:[e.jsxs("div",{children:[e.jsx(xt,{text:a,handleChange:x}),e.jsx(mt,{text:a,handleErase:y,handleButtonClick:w,isSendDisabled:M,handleHistoryClick:m})]}),e.jsx(yt,{options:n,onOptionChange:o})]})]}),e.jsxs("div",{className:"flex flex-col justify-start",children:[e.jsx("p",{className:"text-xs text-sky-500 mt-1 italic",children:"* Nội dung được dịch bằng AI"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Phím tắt: Ctrl+Enter = Dịch · Ctrl+H = Lịch sử · Ctrl+X = Xóa"})]}),l&&e.jsx(ft,{onClose:m,onRepeat:G})]})}const vt=()=>{const{generateContent:n}=Te();return{dichCachDoc:async(r,o)=>{if(o!=null&&o.theLoaiGiaoTiep,!r||typeof r!="string")return{error:"Dữ liệu đầu vào không hợp lệ"};const a=`
        Role: JLPT Expert.
        Task: Process "${r}".
        Logic:
        1. If input is NOT Japanese, translate it into natural Japanese.
        2. If input IS Japanese, use it directly.
        3. Analyze grammar and vocabulary.
        4. All explanations/meanings must be in VIETNAMESE.

        Output: Minified RAW JSON only (No Markdown, no whitespace).

        Schema:
        {
            "japanese": "Japanese text",
            "romaji": "Romaji",
            "list_vocabulary": [
                {
                    "word": "Word",
                    "meaning": "Vietnamese meaning"
                }
            ],
            "list_structure": [
                {
                    "special_structure": "Grammar Name Vietnamese explanation",
                    "analysis": "Short Vietnamese explanation"
                }
            ]
        }`;try{const h=await n(a);h.startsWith("Lỗi")&&alert("Lỗi : Máy chủ Google AI đang quá tải. Thử lại sau 1 phút.");const l=h.match(/\{[\s\S]*\}/);return l?JSON.parse(l[0]):null}catch{return{original:r,japanese:"Lỗi: Máy chủ Google AI đang bảo trì. Thử lại sau 1-2 phút. @@",romaji:"",list_vocabulary:[{word:"",meaning:""}],list_structure:[{special_structure:"",analysis:"T.T"}]}}}}},ne=p.createContext({options:{},inputText:"",aiCallBack:"",isLoading:!1,error:null,setInputText:()=>{},setOptions:()=>{}});function Ot(){const n=Ne(),{dichCachDoc:t}=vt(),[r,o]=p.useState(""),[a,h]=p.useState(""),[l,u]=p.useState({theLoaiGiaoTiep:"lịch sự"}),[x,w]=p.useState(!1),[y,m]=p.useState(null);p.useEffect(()=>{window.scrollY&&window.scrollTo({top:0,behavior:"smooth"})},[]);const G=(M,R,E)=>{try{const N=localStorage.getItem("dichHistory")||"[]",S=JSON.parse(N).map(C=>JSON.parse(decodeURIComponent(atob(C))));if(S.some(C=>C.inputText===M&&JSON.stringify(C.options)===JSON.stringify(R))){console.log("Mục giống hệt đã tồn tại, không lưu.");return}const I={id:Date.now(),inputText:M,options:R,aiCallBack:E},f=S.findLastIndex(C=>C.inputText===M);f!==-1?(console.log(`Tìm thấy nhóm cho '${M}'. Chèn vào sau vị trí ${f}.`),S.splice(f+1,0,I)):S.push(I);const T=S.map(C=>{const j=JSON.stringify(C);return btoa(encodeURIComponent(j))});localStorage.setItem("dichHistory",JSON.stringify(T))}catch(N){console.error("Lỗi khi tự động lưu lịch sử:",N)}};return p.useEffect(()=>{if(!a){o(""),m(null),w(!1);return}const R=(()=>{try{const N=localStorage.getItem("dichHistory")||"[]",S=JSON.parse(N).find(z=>{const I=JSON.parse(decodeURIComponent(atob(z)));return I.inputText===a&&JSON.stringify(I.options)===JSON.stringify(l)});return S?JSON.parse(decodeURIComponent(atob(S))):null}catch{return null}})();if(R){console.log("Tìm thấy kết quả trong cache."),o(R.aiCallBack),w(!1),m(null);return}(async()=>{w(!0),m(null);try{const N=await t(a,l);G(a,l,N),o(N)}catch(N){N.response&&N.response.status===429&&alert("Bạn đã gửi quá nhiều yêu cầu. Vui lòng thử lại sau một lát."),m(N),o("")}finally{w(!1)}})()},[a,l]),e.jsx(ne.Provider,{value:{options:l,inputText:a,aiCallBack:r,isLoading:x,error:y,setOptions:u,setInputText:h},children:e.jsxs("section",{className:"min-h-screen px-5 mb-5 xl:p-0",children:[e.jsx("div",{className:"mb-5",children:n}),e.jsx(Se,{}),e.jsxs("div",{className:"w-full flex flex-col gap-10",children:[e.jsx(bt,{}),e.jsx(pt,{})]})]})})}export{ne as DichContext,Ot as default};
