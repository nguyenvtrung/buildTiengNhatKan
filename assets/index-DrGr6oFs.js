import{r as o,j as e,T as D,R as E,I as g}from"./index-ByT4KsQN.js";import{u as J}from"./index-DO-ii5RA.js";import{A as O}from"./index-DHpQ-tJo.js";import{u as A}from"./Model-Vkxu4KUG.js";import{a as z}from"./index-BJPuBdRG.js";import{G as B}from"./iconBase-MXzLadDV.js";import{a as V}from"./index-Dzx410S6.js";import{B as T}from"./ButtonVoidText-Dw55UTC8.js";import{L as C}from"./index-QBkZ-6wL.js";import{L as R}from"./index-Dq5wm3RH.js";import"./Breadcrumbs-Bak1qK7Q.js";function P(t){return B({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M319.61 20.654c13.145 33.114 13.144 33.115-5.46 63.5 33.114-13.145 33.116-13.146 63.5 5.457-13.145-33.114-13.146-33.113 5.457-63.498-33.114 13.146-33.113 13.145-63.498-5.459zM113.024 38.021c-11.808 21.04-11.808 21.04-35.724 24.217 21.04 11.809 21.04 11.808 24.217 35.725 11.808-21.04 11.808-21.04 35.724-24.217-21.04-11.808-21.04-11.808-24.217-35.725zm76.55 56.184c-.952 50.588-.95 50.588-41.991 80.18 50.587.95 50.588.95 80.18 41.99.95-50.588.95-50.588 41.99-80.18-50.588-.95-50.588-.95-80.18-41.99zm191.177 55.885c-.046 24.127-.048 24.125-19.377 38.564 24.127.047 24.127.046 38.566 19.375.047-24.126.046-24.125 19.375-38.564-24.126-.047-24.125-.046-38.564-19.375zm-184.086 83.88c-1.191.024-2.36.07-3.492.134-18.591 1.064-41.868 8.416-77.445 22.556L76.012 433.582c78.487-20.734 132.97-21.909 170.99-4.615V247.71c-18.076-8.813-31.79-13.399-46.707-13.737a91.166 91.166 0 0 0-3.629-.002zm122.686 11.42c-2.916-.026-5.81.011-8.514.098-12.81.417-27.638 2.215-45.84 4.522V427.145c43.565-7.825 106.85-4.2 171.244 7.566l-39.78-177.197c-35.904-8.37-56.589-11.91-77.11-12.123zm2.289 16.95c18.889.204 36.852 2.768 53.707 5.02l4.437 16.523c-23.78-3.75-65.966-4.906-92.467-.98l-.636-17.805c11.959-2.154 23.625-2.88 34.959-2.758zm-250.483 4.658l-10.617 46.004h24.094l10.326-46.004H71.158zm345.881 0l39.742 177.031 2.239 9.973 22.591-.152-40.855-186.852h-23.717zm-78.857 57.82c16.993.026 33.67.791 49.146 2.223l3.524 17.174c-32.645-3.08-72.58-2.889-102.995 0l-.709-17.174c16.733-1.533 34.04-2.248 51.034-2.223zm-281.793 6.18l-6.924 30.004h24.394l6.735-30.004H56.389zm274.418 27.244c4.656.021 9.487.085 14.716.203l2.555 17.498c-19.97-.471-47.115.56-59.728 1.05l-.7-17.985c16.803-.493 29.189-.828 43.157-.766zm41.476.447c8.268.042 16.697.334 24.121.069l2.58 17.74c-8.653-.312-24.87-.83-32.064-.502l-2.807-17.234a257.25 257.25 0 0 1 8.17-.073zm-326.97 20.309l-17.985 77.928 25.035-.17 17.455-77.758H45.313zm303.164 11.848c19.608-.01 38.66.774 56.449 2.572l2.996 20.787c-34.305-4.244-85.755-7.697-119.1-3.244l-.14-17.922c20.02-1.379 40.186-2.183 59.795-2.193zm-166.606 44.05c-30.112.09-67.916 6.25-115.408 19.76l-7.22 2.053 187.759-1.27v-6.347c-16.236-9.206-37.42-14.278-65.13-14.196zm134.41 6.174c-19.63.067-37.112 1.439-51.283 4.182v10.064l177.594-1.203c-44.322-8.634-89.137-13.17-126.31-13.043zM26 475v18h460v-18H26z"},child:[]}]})(t)}const G=o.memo(({title:t})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:t}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]}));function M({title:t}){const{inputText:r,aiCallBack:a,isLoading:n,error:s}=o.useContext(N),{romaji:l,japanese:i}=a||{},c=()=>n?e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(C,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}):s?e.jsxs("p",{className:"text-red-500",children:["Lỗi: ",s.message||"Đã có lỗi xảy ra"]}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Nội dung:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(T,{text:r,language:"vi-VN"}),e.jsx("p",{children:r})]})]}),i&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Dịch:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(T,{text:i,language:"ja-JP"}),e.jsx("p",{children:i})]})]}),l&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800 italic text-sm",children:"Cách đọc:"}),e.jsx("p",{children:l})]})]}):e.jsx("p",{children:"Vui lòng nhập nội dung cần dịch."});return e.jsxs("div",{className:"w-full shadow shadow-gray-400  rounded-b-2xl p-5 ",children:[e.jsx(G,{title:t||"Dịch - Cách đọc"}),c()]})}const $=o.memo(({title:t})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:t}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]})),_=o.memo(({item:t})=>{const{special_structure:r,html:a,analysis:n}=t||{},s=i=>i?i.replace(/Aい/g,"A<sub>い</sub><sub class='text-gray-800 italic'>( Tính từ đuôi い)</sub>").replace(/Aな/g,"A<sub>な</sub><sub class='text-gray-800 italic'>( Tính từ đuôi な)</sub>").replace(/V(る|て|た|ない)/g,"V<sub>$1</sub>").replace("V-masu","V<sub>ます</sub>").replace("N/Na-adj","N<sub class='text-gray-800 italic'>( Danh từ )</sub>").replace(/\*\*(.*?)\*\*/g,"<br><b>$1</b><br>"):"",l=o.useMemo(()=>s(String(r)||""),[r]);return e.jsx(D,{title:`Chi tiết cấu trúc:${r}`||"",placement:"top",arrow:!0,children:e.jsxs("details",{className:"group cursor-pointer p-3 border-b last:border-0 border-gray-100 dark:border-gray-700",children:[e.jsx("summary",{className:"flex items-center justify-between list-none outline-none",children:e.jsx("div",{className:"text-sky-800 dark:text-sky-400 font-bold text-lg hover:text-sky-600 transition-colors",dangerouslySetInnerHTML:{__html:l}})}),e.jsx("div",{className:"grid grid-rows-[0fr] transition-all duration-300 ease-in-out group-open:grid-rows-[1fr]",children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"pt-3 pl-4 border-l-2 border-gray-200 dark:border-gray-600 ml-1 mt-1",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic",children:n})})})})]})})});function X({title:t}){const{aiCallBack:r,isLoading:a,error:n}=o.useContext(N),{list_structure:s}=r||{};return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-b-2xl p-5 ",children:[e.jsx($,{title:t||"Phân tích"}),a&&e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(C,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}),(s==null?void 0:s.length)>0&&!a&&e.jsx("div",{className:"mt-2",children:e.jsx("ul",{className:" list-inside flex  flex-col gap-5",children:s.map((l,i)=>e.jsx("li",{className:"shadow shadow-gray-400 p-2 rounded-2xl",children:e.jsx(_,{item:l})},i))})}),!a&&(!s||s.length===0)&&e.jsx("p",{className:"text-center text-gray-400 mt-4 text-sm",children:"Không tìm thấy cấu trúc ngữ pháp đặc biệt."})]})}const U=o.memo(({title:t})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:t}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]})),K=o.memo(({item:t})=>e.jsxs("li",{className:"w-full h-full shadow shadow-gray-400 p-2 rounded-2xl bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsxs("div",{className:"flex gap-2 items-center text-xl text-sky-800 dark:text-sky-200",children:[e.jsx(R,{}),e.jsx("span",{className:"font-Japan font-bold",children:t==null?void 0:t.word})]}),e.jsx(T,{text:t==null?void 0:t.word,language:"ja-JP"})]}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-xl p-2 mt-2",children:e.jsx("p",{className:"text-sm lg:text-base",children:t==null?void 0:t.meaning})})]}));function F({title:t}){const{aiCallBack:r,isLoading:a,error:n}=o.useContext(N),{list_vocabulary:s}=r||{};return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-b-2xl p-5 ",children:[e.jsx(U,{title:t||"Phân tích"}),a&&e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(C,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}),(s==null?void 0:s.length)>0&&!a&&e.jsx("div",{className:"mt-2",children:e.jsx("ul",{className:" grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-5",children:s.map((l,i)=>{const c=l!=null&&l.word?`${l.word}-${i}`:i;return e.jsx(K,{item:l},c)})})}),!a&&(!s||s.length===0)&&e.jsx("p",{className:"text-center text-gray-400 mt-4 text-sm",children:"Không tìm thấy từ vựng đặc biệt."})]})}const q=o.memo(F);function W({aiCallBack:t}){const[r,a]=E.useState("tab1");o.useEffect(()=>{t&&a("tab1")},[t]);const n=(s,l)=>"dark:text-white flex-1 text-center py-1  px-4 flex items-center justify-center gap-2 text-lg font-medium border-b-4 transition-all duration-300 "+(l===s?"border-indigo-700 text-indigo-800":"border-transparent text-gray-600  hover:text-gray-800 hover:border-gray-300 dark:hover:text-white");return e.jsxs("section",{children:[e.jsxs("nav",{className:"flex justify-between bg-white dark:bg-gray-800  border-b border-gray-200 rounded-t-lg",children:[e.jsxs("button",{onClick:()=>a("tab1"),className:n("tab1",r),children:[e.jsx(z,{className:"text-xl"}),e.jsx("span",{className:"hidden md:block",children:"Dịch - cách đọc"})]}),e.jsxs("button",{onClick:()=>a("tab2"),className:n("tab2",r),children:[e.jsx(P,{className:"text-xl"}),e.jsx("span",{className:"hidden md:block",children:"Phân tích cấu trúc"})]}),e.jsxs("button",{onClick:()=>a("tab3"),className:n("tab3",r),children:[e.jsx(V,{className:"text-xl"}),e.jsx("span",{className:"hidden md:block",children:"Danh sách từ vựng"})]})]}),e.jsxs("div",{className:"",children:[r==="tab1"&&e.jsx(M,{title:"Dịch"}),r==="tab2"&&e.jsx(X,{title:"Cấu trúc"}),r==="tab3"&&e.jsx(q,{title:"Từ vựng"})]})]})}function Y(){const{aiCallBack:t,isLoading:r}=o.useContext(N);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col  md:flex-row justify-between gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{iconName:"faCrown",className:"text-2xl text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Phân tích"})]}),e.jsx("h5",{className:"text-gray-400 text-sm italic",children:location.href})]}),e.jsx("div",{className:"flex flex-col gap-5 select-text mt-2",children:e.jsx(W,{aiCallBack:t})})]})}function Q({onClose:t,onRepeat:r}){const[a,n]=o.useState([]),s=()=>{try{const c=localStorage.getItem("dichHistory");if(c){const m=JSON.parse(c).map(p=>{const x=atob(p),v=decodeURIComponent(x);return JSON.parse(v)});n(m)}else n([])}catch(c){console.error("Failed to load history from localStorage:",c),localStorage.removeItem("dichHistory"),n([])}};o.useEffect(()=>{s()},[]);const l=()=>{window.confirm("Bạn có chắc chắn muốn xóa TOÀN BỘ lịch sử dịch? Thao tác này không thể hoàn tác.")&&(localStorage.removeItem("dichHistory"),n([]))},i=c=>{if(window.confirm("Bạn có chắc chắn muốn xóa mục này?")){const u=a.filter(p=>p.id!==c),m=u.map(p=>{const x=JSON.stringify(p);return btoa(encodeURIComponent(x))});localStorage.setItem("dichHistory",JSON.stringify(m)),n(u)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 flex justify-center items-center",onClick:t,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-[90%] max-w-2xl max-h-[80vh] flex flex-col",onClick:c=>c.stopPropagation(),children:[e.jsxs("header",{className:"flex flex-wrap justify-between items-center p-4 border-b dark:border-gray-600",children:[e.jsxs("h2",{className:"text-xl font-bold text-sky-800 dark:text-sky-400",children:[e.jsx(g,{iconName:"faClipboardList",className:"mr-2"}),"Lịch sử đã lưu"]}),e.jsxs("div",{className:"flex items-center justify-end  gap-4",children:[a.length>0&&e.jsxs("button",{onClick:l,title:"Xóa toàn bộ lịch sử",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(g,{iconName:"faTrashCan"}),e.jsx("span",{children:"Xóa tất cả"})]}),e.jsx("button",{onClick:t,className:"text-gray-600 border border-gray-300 px-3 py-1.5 text-sm font-medium rounded-md hover:text-red-800 dark:text-gray-300 dark:hover:text-white",children:"Đóng"})]})]}),e.jsx("main",{className:"p-5 overflow-y-auto",children:a.length>0?e.jsx("ul",{className:"space-y-3",children:a.slice().reverse().map(c=>{var u;return e.jsxs("li",{className:"flex flex-col gap-2 md:flex-row justify-between w-full  items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"w-full md:w-fit flex items-center justify-between px-2 gap-2 md:border-r md:pr-2 mr-4",children:[e.jsx("button",{onClick:()=>r(c),title:"Dùng lại",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-sky-700 hover:text-sky-900 dark:text-sky-400 dark:hover:text-sky-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:e.jsx(g,{iconName:"faRepeat"})}),e.jsx("button",{onClick:()=>i(c.id),title:"Xóa mục này",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:e.jsx(g,{iconName:"faTrashCan"})})]}),e.jsxs("div",{className:"w-full overflow-hidden px-2 mr-4",children:[e.jsx("p",{className:"text-gray-800 dark:text-gray-200 truncate",title:c.inputText,children:c.inputText}),e.jsxs("div",{className:" flex gap-2 text-xs italic text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("p",{children:"Phong cách : "}),e.jsx("p",{children:((u=c.options)==null?void 0:u.theLoaiGiaoTiep)||"không rõ"})]})]})]},c.id)})}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Chưa có lịch sử nào được lưu."})})]})})}function Z({text:t,handleErase:r,handleButtonClick:a,isSendDisabled:n,handleHistoryClick:s}){return e.jsxs("div",{className:"flex items-center justify-end gap-2 p-1.5 ",children:[e.jsxs("button",{type:"button",onClick:s,title:"Xem lịch sử",className:"dark:text-white group flex items-center gap-1 transition-all justify-center rounded border border-gray-300 hover:border-sky-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-sky-900",children:[e.jsx(g,{iconName:"faClipboardList"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Lịch sử"})]}),e.jsxs("button",{type:"button",className:`${t.length>0?"opacity-100":"opacity-0 pointer-events-none"} dark:text-white group flex items-center gap-1 transition-all rounded border border-gray-300 hover:border-red-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-red-900`,onClick:r,children:[e.jsx(g,{iconName:"faEraser"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Xóa"})]}),e.jsxs("button",{type:"button",onClick:a,disabled:n,className:`dark:text-white rounded group flex items-center gap-1 border border-gray-300 px-3 py-1.5 text-sm font-medium shadow-sm transition-colors hover:bg-gray-100 ${n?"opacity-50 cursor-not-allowed text-gray-900":"cursor-pointer text-sky-600"}`,children:[e.jsx(g,{iconName:"faPaperPlane"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Dịch"})]})]})}function ee({text:t,handleChange:r}){return e.jsx("textarea",{id:"Notes",className:"w-full resize-none border-none focus:ring-0 sm:text-sm outline-none h-full px-3 py-2",placeholder:"Ví dụ : Tiếng nhật khó nhưng thú vị.",value:t,onChange:r})}function te({options:t,onOptionChange:r}){const a=n=>{r({...t,theLoaiGiaoTiep:n.target.value})};return e.jsx("div",{className:"w-full p-2",children:e.jsxs("label",{htmlFor:"theLoaiGiaoTiep",className:"cursor-pointer w-full",children:[e.jsx("div",{className:"text-sm font-medium border-b w-full text-gray-700 dark:text-gray-200",children:e.jsx("p",{children:"Thể loại giao tiếp"})}),e.jsxs("select",{onChange:a,name:"theLoaiGiaoTiep",id:"theLoaiGiaoTiep",value:(t==null?void 0:t.theLoaiGiaoTiep)||"lịch sự",className:"mt-0.5 p-1 w-full rounded-b-xl border border-gray-300 shadow-sm outline-none text-sm dark:border-gray-600 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"lịch sự",children:"Lịch sự"}),e.jsx("option",{value:"thông thường",children:"Thông thường"}),e.jsx("option",{value:"suồng sã",children:"Suồng sã"}),e.jsx("option",{value:"cục súc",children:"Cục súc"}),e.jsx("option",{value:"nói với cấp trên",children:"Nói với cấp trên"}),e.jsx("option",{value:"nói với cấp dưới",children:"Nói với cấp dưới"}),e.jsx("option",{value:"nói với đồng nghiệp",children:"Nói với đồng nghiệp"})]})]})})}function se(){const{options:t,inputText:r,setInputText:a,setOptions:n}=o.useContext(N),[s,l]=o.useState(""),[i,c]=o.useState(!1);o.useEffect(()=>{l(r)},[r]),o.useEffect(()=>{const h=f=>{if(!f.ctrlKey)return;const d=f.key.toLowerCase();if(d==="enter"){f.preventDefault(),m();return}if(d==="h"){f.preventDefault(),x();return}if(d==="x"){f.preventDefault(),p();return}};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[s,r]);const u=h=>{l(h.target.value)},m=()=>{s.length>0&&a(s)},p=()=>{window.confirm("Xoá toàn bộ nội dung của bạn?")&&(l(""),a(""))},x=()=>{c(!i)},v=h=>{window.confirm("Bạn có muốn sử dụng lại nội dung này?")&&(a(h.inputText),n(h.options),x())},b=s.length===0||s===r;return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("label",{htmlFor:"Notes",children:[e.jsxs("div",{className:"flex justify-start items-center gap-2",children:[e.jsx(g,{iconName:"faLanguage",className:"text-2xl text-sky-800"}),e.jsx("span",{className:"text-2xl font-bold",children:"Tôi muốn nói"})]}),e.jsxs("div",{className:"relative h-full flex flex-col mt-0.5 overflow-hidden rounded-2xl border border-gray-300 shadow-sm focus-within:ring focus-within:ring-green-600 ",children:[e.jsxs("div",{children:[e.jsx(ee,{text:s,handleChange:u}),e.jsx(Z,{text:s,handleErase:p,handleButtonClick:m,isSendDisabled:b,handleHistoryClick:x})]}),e.jsx(te,{options:t,onOptionChange:n})]})]}),e.jsxs("div",{className:"flex flex-col justify-start",children:[e.jsx("p",{className:"text-xs text-sky-500 mt-1 italic",children:"* Nội dung được dịch bằng AI"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Phím tắt: Ctrl+Enter = Dịch · Ctrl+H = Lịch sử · Ctrl+X = Xóa"})]}),i&&e.jsx(Q,{onClose:x,onRepeat:v})]})}const re=()=>{const{generateContent:t}=A();return{dichCachDoc:async(a,n)=>{if(n!=null&&n.theLoaiGiaoTiep,!a||typeof a!="string")return{error:"Dữ liệu đầu vào không hợp lệ"};const s=`
        Role: JLPT Expert.
        Task: Process "${a}".
        Logic:
        1. If input is NOT Japanese, translate it into natural Japanese.
        2. If input IS Japanese, use it directly.
        3. Analyze grammar and vocabulary.
        4. All explanations/meanings must be in VIETNAMESE.

        Output: Minified RAW JSON only (No Markdown, no whitespace).

        Schema:
        {
            "japanese": "Japanese text",
            "romaji": "Romaji",
            "list_vocabulary": [
                {
                    "word": "Word",
                    "meaning": "Vietnamese meaning"
                }
            ],
            "list_structure": [
                {
                    "special_structure": "Grammar Name Vietnamese explanation",
                    "analysis": "Short Vietnamese explanation"
                }
            ]
        }`;try{const l=await t(s);l.startsWith("Lỗi")&&alert("Lỗi : Máy chủ Google AI đang quá tải. Thử lại sau 1 phút.");const i=l.match(/\{[\s\S]*\}/);return i?JSON.parse(i[0]):null}catch{return{original:a,japanese:"Lỗi: Máy chủ Google AI đang bảo trì. Thử lại sau 1-2 phút. @@",romaji:"",list_vocabulary:[{word:"",meaning:""}],list_structure:[{special_structure:"",analysis:"T.T"}]}}}}},N=o.createContext({options:{},inputText:"",aiCallBack:"",isLoading:!1,error:null,setInputText:()=>{},setOptions:()=>{}});function pe(){const t=J(),{dichCachDoc:r}=re(),[a,n]=o.useState(""),[s,l]=o.useState(""),[i,c]=o.useState({theLoaiGiaoTiep:"lịch sự"}),[u,m]=o.useState(!1),[p,x]=o.useState(null);o.useEffect(()=>{window.scrollY&&window.scrollTo({top:0,behavior:"smooth"})},[]);const v=(b,h,f)=>{try{const d=localStorage.getItem("dichHistory")||"[]",y=JSON.parse(d).map(j=>JSON.parse(decodeURIComponent(atob(j))));if(y.some(j=>j.inputText===b&&JSON.stringify(j.options)===JSON.stringify(h))){console.log("Mục giống hệt đã tồn tại, không lưu.");return}const k={id:Date.now(),inputText:b,options:h,aiCallBack:f},w=y.findLastIndex(j=>j.inputText===b);w!==-1?(console.log(`Tìm thấy nhóm cho '${b}'. Chèn vào sau vị trí ${w}.`),y.splice(w+1,0,k)):y.push(k);const I=y.map(j=>{const H=JSON.stringify(j);return btoa(encodeURIComponent(H))});localStorage.setItem("dichHistory",JSON.stringify(I))}catch(d){console.error("Lỗi khi tự động lưu lịch sử:",d)}};return o.useEffect(()=>{if(!s){n(""),x(null),m(!1);return}const h=(()=>{try{const d=localStorage.getItem("dichHistory")||"[]",y=JSON.parse(d).find(S=>{const k=JSON.parse(decodeURIComponent(atob(S)));return k.inputText===s&&JSON.stringify(k.options)===JSON.stringify(i)});return y?JSON.parse(decodeURIComponent(atob(y))):null}catch{return null}})();if(h){console.log("Tìm thấy kết quả trong cache."),n(h.aiCallBack),m(!1),x(null);return}(async()=>{m(!0),x(null);try{const d=await r(s,i);v(s,i,d),n(d)}catch(d){d.response&&d.response.status===429&&alert("Bạn đã gửi quá nhiều yêu cầu. Vui lòng thử lại sau một lát."),x(d),n("")}finally{m(!1)}})()},[s,i]),e.jsx(N.Provider,{value:{options:i,inputText:s,aiCallBack:a,isLoading:u,error:p,setOptions:c,setInputText:l},children:e.jsxs("section",{className:"min-h-screen px-5 mb-5 xl:p-0",children:[e.jsx("div",{className:"mb-5",children:t}),e.jsx(O,{}),e.jsxs("div",{className:"w-full flex flex-col gap-10",children:[e.jsx(se,{}),e.jsx(Y,{})]})]})})}export{N as DichContext,pe as default};
