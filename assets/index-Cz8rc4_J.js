import{r as s,R as B,j as e,I as A,aa as O,u as H,ab as V}from"./index-DFMJk8BF.js";import{u as G}from"./index-D3GNFJ3w.js";import{B as Q,a as U,T as q,v as W}from"./ButtonToolJLPT-B8HBSP8m.js";import{u as Z}from"./index-CDrEZtDK.js";import"./Model-CkONpvBT.js";import"./index-t--hEgTQ.js";import"./index-Cs_f-VNv.js";import"./Breadcrumbs-PNXGyQyV.js";const _=l=>{if(!l)return null;const n="bottom",[o,S]=s.useState({}),[C,T]=s.useState({}),[y,M]=s.useState(!1),d=s.useRef([]),m=s.useRef([]),r=s.useRef([]),I=/([\u4e00-\u9faf]+|\d+)\s*[（(](.*?)[）)]/g,a=String(l).match(/<truvndich>(.*?)<\/truvndich>/),R=String(l).replace(/<truvndich>(.*?)<\/truvndich>/,""),u=[...R.matchAll(I)];d.current.length!==u.length&&(d.current=u.map((c,t)=>d.current[t]??B.createRef()),m.current=u.map((c,t)=>m.current[t]??B.createRef()),r.current=u.map((c,t)=>r.current[t]??B.createRef()));const $=c=>{S(t=>({...t,[c]:!t[c]}))};s.useEffect(()=>{(()=>{var p,f;const t={},h=Object.keys(o).filter(i=>o[i]).map(Number).sort((i,b)=>{var x,j,N,w;const g=(j=(x=m.current[i])==null?void 0:x.current)==null?void 0:j.getBoundingClientRect(),v=(w=(N=m.current[b])==null?void 0:N.current)==null?void 0:w.getBoundingClientRect();return((g==null?void 0:g.left)||0)-((v==null?void 0:v.left)||0)});h.forEach(i=>t[i]=0);for(let i=0;i<h.length;i++){const b=h[i],g=(p=d.current[b])==null?void 0:p.current;if(!g)continue;let v=g.getBoundingClientRect();for(let x=0;x<i;x++){const j=h[x],N=(f=d.current[j])==null?void 0:f.current;if(!N)continue;const w=N.getBoundingClientRect();v.left<w.right&&v.right>w.left&&(t[b]=(t[j]||0)+w.height+5,t[b])}}T(t)})()},[o]),s.useEffect(()=>{u.forEach((c,t)=>{var i,b,g;const h=(i=d.current[t])==null?void 0:i.current,p=(b=m.current[t])==null?void 0:b.current,f=(g=r.current[t])==null?void 0:g.current;if(h&&p&&f&&o[t]){const v=h.getBoundingClientRect(),x=p.getBoundingClientRect(),j=p.parentElement.getBoundingClientRect(),N=(v.left+v.right)/2,w=(x.left+x.right)/2;let P,z;P=v.bottom,z=x.top;const F=Math.abs(z-P),D=Math.abs(N-w)+10,L=Math.min(N,w)-j.left-5;{const Y=j.bottom-x.top;f.style.bottom=`${Y}px`,f.style.top="auto"}const J=N-(L+j.left),K=w-(L+j.left);let X="";X=`M${J} 0 V${F} H${K}`,f.setAttribute("width",D),f.setAttribute("height",F),f.style.left=`${L+3.5}px`,f.innerHTML=`<path d="${X}" stroke="#b91c1c" stroke-width="1.5" fill="none" />`}})},[o,C]);let E=0;const k=[];return u.forEach((c,t)=>{const h=c[0],p=c[1],f=c[2],i=c.index,b=C[t]||0,g=R.substring(E,i);g&&k.push(e.jsx(B.Fragment,{children:g},`pre-${t}`)),k.push(e.jsxs("span",{style:{position:"relative",display:"inline-block"},children:[e.jsx("span",{ref:m.current[t],onMouseEnter:()=>$(t),onMouseLeave:()=>$(t),style:{cursor:"pointer",borderBottom:"1px dotted #234212"},className:"transition-all hover:text-red-800 hover:bg-amber-50/90 hover:shadow hover:shadow-amber-800/50 hover:rounded-sm hover:px-1",children:p}),o[t]&&e.jsxs(e.Fragment,{children:[e.jsx("span",{ref:d.current[t],className:"text-sm text-red-800 bg-amber-50/90 shadow shadow-amber-800/50 rounded-sm px-1",style:{position:"absolute",[n]:`calc(100% + ${b+5}px)`,left:"50%",transform:"translateX(-50%)",whiteSpace:"nowrap",zIndex:10},children:f}),e.jsx("svg",{ref:r.current[t],style:{position:"absolute",zIndex:9,overflow:"visible",pointerEvents:"none"}})]})]},`container-${t}`)),E=i+h.length}),k.push(e.jsx(B.Fragment,{children:R.substring(E)},"remaining")),e.jsxs("div",{className:"relative flex flex-col",children:[e.jsx("div",{className:"pr-6",children:k}),a&&e.jsx("div",{className:"z-20 cursor-pointer hover:bg-indigo-400 hover:text-white text-[9px] text-indigo-800 font-bold absolute px-2 py-1 rounded-full bg-white border border-indigo-800 top-1/2 -translate-y-1/2 right-0 translate-x-1/2 transition-all",onClick:c=>{c.stopPropagation(),M(!y)},children:y?e.jsx(A,{iconName:"faClose"}):"Dịch"}),y&&a&&e.jsx("p",{className:"z-10 absolute top-1/2 text-xs h-full w-full overflow-y-auto -translate-y-1/2 left-0 text-white bg-gray-600 px-2 rounded-md italic",children:a[1]})]})},tt=s.memo(({dapAn:l,id:n,isSelected:o,isSuccess:S,onClick:C,index:T})=>{const{settings:y}=s.useContext(O),{styleFontSize:M}=y,d=`cursor-pointer px-4 py-1 w-full rounded-l-2xl  transition-all ${o?"border-gray-800 dark:border-white":"border-transparent"} ${o&&S?"  rounded-l-2xl transition-all text-white duration-200 bg-gradient-to-r from-green-900  via-green-800 via-95% to-transparent":o&&!S?" rounded-l-2xl transition-all text-white duration-200 bg-gradient-to-r from-red-900  via-red-800 via-90% to-transparent":""}`;return e.jsxs("li",{style:{fontSize:`${M}px`},className:`relative bg-[var(--color-main)]/5 rounded-2xl ${l===""?"hidden":"flex gap-2 items-center"}`,children:[e.jsx("input",{className:"peer/trung hidden",type:"checkbox",name:n,id:n,checked:o,readOnly:!0}),e.jsx("div",{className:"absolute  left-0 -translate-x-1/2 top-1/2 -translate-y-1/2  bg-white h-5 w-5 border rounded-full  border-indigo-800",children:e.jsx("p",{className:"text-indigo-800 text-sm font-bold absolute  left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2",children:T+1})}),e.jsx("label",{htmlFor:n,className:d,onClick:C,children:e.jsx("div",{children:_(l)})})]})}),et=s.memo(({data:l,index:n,settings:o})=>{if(!(l!=null&&l.cauhoi))return null;const{settings:S}=s.useContext(O),{styleColumn:C,styleFontSize:T}=S,{styleGDTrueFalse:y,styleColorTitle:M,styleColorShadow:d}=o,{dapan:m,cauhoi:r,img:I}=l,[a,R]=s.useState([]),u=s.useMemo(()=>a[n]!==void 0&&a[n]!==null,[a,n]),$=s.useMemo(()=>a[n]===m,[a,n,m]),E=s.useCallback(t=>{R(h=>{const p=[...h];return p[n]=Number(t),p})},[n]),k=()=>{const t="jlpt text-lg font-bold";return y?u&&$?`${t} text-green-800 border-b-2 border-green-800 transition-all duration-200`:u&&!$?`${t} text-red-800 border-b-2 border-red-800 transition-all duration-200`:`${t} text-gray-800 dark:text-white border-b-2 border-transparent transition-all duration-200`:t},c=()=>u&&$?"#016630":u?"#9f0712":d;return e.jsx("div",{style:{"--jlpt-color-shadow-box":c()},className:"jlptBorderShadow p-4 rounded-md font-Japan",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[I&&e.jsx("img",{src:I,alt:"img",className:"w-1/3 mx-auto"}),e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("div",{className:"w-full flex items-center gap-4",style:{fontSize:`${T}px`},children:e.jsx("h2",{style:{"--jlpt-title-u":M},className:k(),children:_(r)||"Loading..."})}),e.jsx(Q,{data:l})]}),e.jsx("ul",{className:`grid gap-2 ${C===1?"grid-cols-1":"grid-cols-2"}`,children:[1,2,3,4].map((t,h)=>e.jsx(tt,{dapAn:l[`dapan${t}`]||"",isSelected:a[n]===t,isSuccess:$&&a[n]===t,onClick:()=>E(t),index:h},`${r}-${n}-${t}`))})]})})});function ut(){const[l,n]=s.useState([]),{itemId:o}=H(),{settings:S}=s.useContext(O),C=o.substring(o.length-3,o.length),T=s.useMemo(()=>{const a=window.location.href;return new URL(a).pathname.split("/").filter(k=>k!=="")[1]},[o]),y=`GET=tokutei&db=${C}&path=${T}`,M=s.useRef(""),d=Z(),{loading:m,apiData:r,fetchData:I}=G(`https://script.google.com/macros/s/AKfycbz59u6ng7B-x442h3wgLCuMvZM2tvuVXLMYkYmFlIk_vsY9j8qgCMHR6NeQb0QpL2NMTg/exec?${y}`,!1,{manual:!0});return s.useEffect(()=>{r!=null&&r.data&&(n(r.data),M.current="")},[r]),s.useEffect(()=>{I(),window.scrollY&&window.scrollTo({top:0,behavior:"smooth"})},[]),m?e.jsx(V,{}):e.jsxs("div",{className:"flex flex-col w-full min-h-screen trungSelectData",children:[e.jsx("div",{className:"px-5",children:d}),e.jsxs("div",{className:"z-50 w-full sticky top-20",children:[e.jsx(U,{view:r==null?void 0:r.views}),e.jsx(q,{})]}),e.jsxs("div",{className:"flex flex-col gap-2 dark:bg-bgColor/50 rounded-2xl px-5 py-5",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-800 dark:text-white text-center my-5",children:(r==null?void 0:r.title)||""}),l.length>0?l.map((a,R)=>{const u={...a};return e.jsx(et,{data:u,index:R,settings:S},a.id||W())}):e.jsx("h1",{className:"text-2xl font-bold text-center",children:"Không có dữ liệu"})]})]})}export{ut as default};
