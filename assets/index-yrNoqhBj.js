import{r as c,j as e,I as g}from"./index-CbkCS8gm.js";import{u as I}from"./index-Cpj2vdWF.js";import{g as D}from"./Model-DzGr2aID.js";import{A as E}from"./index-DsAFcszT.js";import{B as T}from"./ButtonVoidText-BW0WkV0c.js";import{L as S}from"./index-BhmkHKuL.js";import"./Breadcrumbs-D_GCQVR_.js";const O=c.memo(({title:r})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:r}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]})),B=r=>{if(!r)return{dich:"",cachDoc:""};const s=r.match(/<dtn>(.*?)<\/dtn>/),n=r.match(/<dcd>(.*?)<\/dcd>/);let t=s?s[1]:"";return t=t.replace(/\((.*?)\)/g,"").trim(),t=t.replace("/"," Hoặc ").trim(),{dich:t,cachDoc:n?n[1]:""}};function J({title:r}){const{inputText:s,aiCallBack:n,isLoading:t,error:o}=c.useContext(k),{dich:i,cachDoc:x}=c.useMemo(()=>B(n),[n]),a=()=>t?e.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[e.jsx(S,{}),e.jsx("p",{className:"text-sky-800 animate-pulse",children:"Đang phân tích"})]}):o?e.jsxs("p",{className:"text-red-500",children:["Lỗi: ",o.message||"Đã có lỗi xảy ra"]}):!i&&!x&&s?e.jsx("p",{children:"Không tìm thấy kết quả."}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Nội dung:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(T,{text:s,language:"vi-VN"}),e.jsx("p",{children:s})]})]}),i&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Dịch:"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(T,{text:i,language:"ja-JP"}),e.jsx("p",{children:i})]})]}),x&&e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Cách đọc:"}),e.jsx("p",{children:x})]})]}):e.jsx("p",{children:"Vui lòng nhập nội dung cần dịch."});return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-2xl p-5 ",children:[e.jsx(O,{title:r||"Dịch - Cách đọc"}),a()]})}const P=c.memo(({title:r})=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-gray-300 dark:to-gray-600"}),e.jsx("span",{className:"shrink-0 px-4 text-red-800 dark:text-white font-bold text-xl",children:r}),e.jsx("span",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-gray-300 dark:to-gray-600"})]}));function A(r){var s;try{return((s=r.match(/<dct>(.*?)<\/dct>/))==null?void 0:s[1])||"Không có dữ liệu cấu trúc"}catch{return"Không có dữ liệu cấu trúc"}}function R(r){var s,n;try{let t=(s=r.match(/<dpt>(.*?)<\/dpt>/s))==null?void 0:s[1];return t||(t=(n=r.match(/<dpt>(.*)/s))==null?void 0:n[1]),t?(t=t.replace(/\*\*(.*?)\*\*/g,"<b class='text-red-800'>$1</b>"),t=t.replace(/\*/g,"<br>"),t.trim()):"Không có dữ liệu phân tích"}catch{return"Không có dữ liệu phân tích"}}function V({title:r}){const{aiCallBack:s,isLoading:n,error:t,inputText:o}=c.useContext(k),i=()=>n?e.jsx("div",{className:"flex flex-col gap-2 items-center",children:e.jsx(S,{})}):t||!s?"Vui lòng nhập nội dung cần dịch.":o?e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{className:"text-sky-800",children:"Sử dụng cấu trúc"}),e.jsx("p",{children:A(s)})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("b",{className:"text-sky-800",children:"Phân tích từ vựng - cấu trúc"}),e.jsx("p",{dangerouslySetInnerHTML:{__html:R(s)}})]})]}):null;return e.jsxs("div",{className:"w-full shadow shadow-gray-400 rounded-2xl p-5 ",children:[e.jsx(P,{title:r||"Phân tích"}),i()]})}function K(){const{inputText:r,options:s,aiCallBack:n,isLoading:t}=c.useContext(k);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{iconName:"faCrown",className:"text-2xl text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Phân tích"})]}),e.jsx("h5",{className:"text-gray-400 text-sm italic",children:location.href})]}),e.jsxs("div",{className:"flex flex-col gap-5 select-text mt-2",children:[e.jsx(J,{title:"Dịch - cách đọc"}),e.jsx(V,{title:"Phân tích"})]})]})}function G({onClose:r,onRepeat:s}){const[n,t]=c.useState([]),o=()=>{try{const a=localStorage.getItem("dichHistory");if(a){const f=JSON.parse(a).map(h=>{const u=atob(h),m=decodeURIComponent(u);return JSON.parse(m)});t(f)}else t([])}catch(a){console.error("Failed to load history from localStorage:",a),localStorage.removeItem("dichHistory"),t([])}};c.useEffect(()=>{o()},[]);const i=()=>{window.confirm("Bạn có chắc chắn muốn xóa TOÀN BỘ lịch sử dịch? Thao tác này không thể hoàn tác.")&&(localStorage.removeItem("dichHistory"),t([]))},x=a=>{if(window.confirm("Bạn có chắc chắn muốn xóa mục này?")){const d=n.filter(h=>h.id!==a),f=d.map(h=>{const u=JSON.stringify(h);return btoa(encodeURIComponent(u))});localStorage.setItem("dichHistory",JSON.stringify(f)),t(d)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 flex justify-center items-center",onClick:r,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-[90%] max-w-2xl max-h-[80vh] flex flex-col",onClick:a=>a.stopPropagation(),children:[e.jsxs("header",{className:"flex flex-wrap justify-between items-center p-4 border-b dark:border-gray-600",children:[e.jsxs("h2",{className:"text-xl font-bold text-sky-800 dark:text-sky-400",children:[e.jsx(g,{iconName:"faClipboardList",className:"mr-2"}),"Lịch sử đã lưu"]}),e.jsxs("div",{className:"flex items-center justify-end  gap-4",children:[n.length>0&&e.jsxs("button",{onClick:i,title:"Xóa toàn bộ lịch sử",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(g,{iconName:"faTrashCan"}),e.jsx("span",{children:"Xóa tất cả"})]}),e.jsx("button",{onClick:r,className:"text-gray-600 border border-gray-300 px-3 py-1.5 text-sm font-medium rounded-md hover:text-red-800 dark:text-gray-300 dark:hover:text-white",children:"Đóng"})]})]}),e.jsx("main",{className:"p-5 overflow-y-auto",children:n.length>0?e.jsx("ul",{className:"space-y-3",children:n.slice().reverse().map(a=>{var d;return e.jsxs("li",{className:"flex justify-between w-full  items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 border-r mr-4",children:[e.jsx("button",{onClick:()=>s(a),title:"Dùng lại",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-sky-700 hover:text-sky-900 dark:text-sky-400 dark:hover:text-sky-200 border border-gray-300 dark:border-gray-500 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:e.jsx(g,{iconName:"faRepeat"})}),e.jsx("button",{onClick:()=>x(a.id),title:"Xóa mục này",className:"flex items-center justify-center w-8 h-8 text-sm font-medium text-red-800 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 rounded-md hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors",children:e.jsx(g,{iconName:"faTrashCan"})})]}),e.jsxs("div",{className:"w-full overflow-hidden mr-4",children:[e.jsx("p",{className:"text-gray-800 dark:text-gray-200 truncate",title:a.inputText,children:a.inputText}),e.jsxs("div",{className:" flex gap-2 text-xs italic text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("p",{children:"Phong cách : "}),e.jsx("p",{children:((d=a.options)==null?void 0:d.theLoaiGiaoTiep)||"không rõ"})]})]})]},a.id)})}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Chưa có lịch sử nào được lưu."})})]})})}function X({text:r,handleErase:s,handleButtonClick:n,isSendDisabled:t,handleHistoryClick:o}){return e.jsxs("div",{className:"flex items-center justify-end gap-2 p-1.5",children:[e.jsxs("button",{type:"button",onClick:o,title:"Xem lịch sử",className:"group flex items-center gap-1 transition-all justify-center rounded border border-gray-300 hover:border-sky-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-sky-900",children:[e.jsx(g,{iconName:"faClipboardList"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Lịch sử"})]}),e.jsxs("button",{type:"button",className:`${r.length>0?"opacity-100":"opacity-0 pointer-events-none"} group flex items-center gap-1 transition-all rounded border border-gray-300 hover:border-red-800 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-red-900`,onClick:s,children:[e.jsx(g,{iconName:"faEraser"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Xóa"})]}),e.jsxs("button",{type:"button",onClick:n,disabled:t,className:`rounded group flex items-center gap-1 border border-gray-300 px-3 py-1.5 text-sm font-medium shadow-sm transition-colors hover:bg-gray-100 ${t?"opacity-50 cursor-not-allowed text-gray-900":"cursor-pointer text-sky-600"}`,children:[e.jsx(g,{iconName:"faPaperPlane"}),e.jsx("p",{className:"h-0 w-0 opacity-0 group-hover:opacity-100 group-hover:h-auto group-hover:w-auto transition-all overflow-hidden whitespace-nowrap",children:"Dịch"})]})]})}function $({text:r,handleChange:s}){return e.jsx("textarea",{id:"Notes",className:"w-full resize-none border-none focus:ring-0 sm:text-sm outline-none h-full px-3 py-2",placeholder:"Ví dụ : Tiếng nhật khó nhưng thú vị.",value:r,onChange:s})}function M({options:r,onOptionChange:s}){const n=t=>{s({...r,theLoaiGiaoTiep:t.target.value})};return e.jsx("div",{className:"w-full p-2",children:e.jsxs("label",{htmlFor:"theLoaiGiaoTiep",className:"cursor-pointer w-full",children:[e.jsx("div",{className:"text-sm font-medium border-b w-full text-gray-700 dark:text-gray-200",children:e.jsx("p",{children:"Thể loại giao tiếp"})}),e.jsxs("select",{onChange:n,name:"theLoaiGiaoTiep",id:"theLoaiGiaoTiep",value:(r==null?void 0:r.theLoaiGiaoTiep)||"lịch sự",className:"mt-0.5 p-1 w-full rounded-b-xl border border-gray-300 shadow-sm outline-none text-sm dark:border-gray-600 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"lịch sự",children:"Lịch sự"}),e.jsx("option",{value:"thông thường",children:"Thông thường"}),e.jsx("option",{value:"suồng sã",children:"Suồng sã"}),e.jsx("option",{value:"cục súc",children:"Cục súc"}),e.jsx("option",{value:"nói với cấp trên",children:"Nói với cấp trên"}),e.jsx("option",{value:"nói với cấp dưới",children:"Nói với cấp dưới"}),e.jsx("option",{value:"nói với đồng nghiệp",children:"Nói với đồng nghiệp"})]})]})})}function U(){const{options:r,inputText:s,setInputText:n,setOptions:t}=c.useContext(k),[o,i]=c.useState(""),[x,a]=c.useState(!1);c.useEffect(()=>{i(s)},[s]),c.useEffect(()=>{const p=l=>{if(!l.ctrlKey)return;const N=l.key.toLowerCase();if(N==="enter"){l.preventDefault(),f();return}if(N==="h"){l.preventDefault(),u();return}if(N==="x"){l.preventDefault(),h();return}};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[o,s]);const d=p=>{i(p.target.value)},f=()=>{o.length>0&&n(o)},h=()=>{window.confirm("Xoá toàn bộ nội dung của bạn?")&&(i(""),n(""))},u=()=>{a(!x)},m=p=>{window.confirm("Bạn có muốn sử dụng lại nội dung này?")&&(n(p.inputText),t(p.options),u())},v=o.length===0||o===s;return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("label",{htmlFor:"Notes",children:[e.jsxs("div",{className:"flex justify-start items-center gap-2",children:[e.jsx(g,{iconName:"faLanguage",className:"text-2xl text-sky-800"}),e.jsx("span",{className:"text-2xl font-bold",children:"Tôi muốn nói"})]}),e.jsxs("div",{className:"relative h-full flex flex-col mt-0.5 overflow-hidden rounded-2xl border border-gray-300 shadow-sm focus-within:ring focus-within:ring-green-600",children:[e.jsxs("div",{children:[e.jsx($,{text:o,handleChange:d}),e.jsx(X,{text:o,handleErase:h,handleButtonClick:f,isSendDisabled:v,handleHistoryClick:u})]}),e.jsx(M,{options:r,onOptionChange:t})]})]}),e.jsxs("div",{className:"flex flex-col justify-start",children:[e.jsx("p",{className:"text-xs text-sky-500 mt-1 italic",children:"* Nội dung được dịch bằng AI"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 italic flex gap-2",children:["* Chức năng được phát triển bởi ",e.jsx("p",{className:"text-red-800",children:location.hostname})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 italic",children:"* Kết quả dịch sẽ được tự động lưu vào lịch sử nếu chưa tồn tại."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Phím tắt: Ctrl+Enter = Dịch · Ctrl+H = Lịch sử · Ctrl+X = Xóa · Ctrl+_ (tùy chỉnh)"})]}),x&&e.jsx(G,{onClose:u,onRepeat:m})]})}async function _(r,s){let{theLoaiGiaoTiep:n}=s;if(typeof r!="string")return"Lỗi type Input";try{const t=`
            "Hãy dịch câu này sang tiếng Nhật và cung cấp cách đọc (romaji) một cách nói ${n}. Nếu trong câu có cấu trúc ngữ pháp đặc biệt, hãy phân tích cấu trúc đó.
            Câu gốc: '${r}'
            Định dạng đầu ra:
            <d>Câu gốc tiếng Việt</d>
            <dtn>Bản dịch tiếng Nhật</dtn>
            <dcd>Cách đọc romaji</dcd>
            <dct>Cấu trúc ngữ pháp đặc biệt (nếu có)</dct>
            <dpt>Phân tích từ vựng , cấu trúc ngữ pháp có trong câu</dpt>"
        `;return await D(t)}catch{return"Lỗi trả lời AI"}}const k=c.createContext({options:{},inputText:"",aiCallBack:"",isLoading:!1,error:null,setInputText:()=>{},setOptions:()=>{}});function ee(){const r=I(),[s,n]=c.useState(""),[t,o]=c.useState(""),[i,x]=c.useState({theLoaiGiaoTiep:"lịch sự"}),[a,d]=c.useState(!1),[f,h]=c.useState(null);c.useEffect(()=>{window.scrollY&&window.scrollTo({top:0,behavior:"smooth"})},[]);const u=(m,v,p)=>{try{const l=localStorage.getItem("dichHistory")||"[]",y=JSON.parse(l).map(j=>JSON.parse(decodeURIComponent(atob(j))));if(y.some(j=>j.inputText===m&&JSON.stringify(j.options)===JSON.stringify(v))){console.log("Mục giống hệt đã tồn tại, không lưu.");return}const b={id:Date.now(),inputText:m,options:v,aiCallBack:p},w=y.findLastIndex(j=>j.inputText===m);w!==-1?(console.log(`Tìm thấy nhóm cho '${m}'. Chèn vào sau vị trí ${w}.`),y.splice(w+1,0,b)):y.push(b);const L=y.map(j=>{const H=JSON.stringify(j);return btoa(encodeURIComponent(H))});localStorage.setItem("dichHistory",JSON.stringify(L))}catch(l){console.error("Lỗi khi tự động lưu lịch sử:",l)}};return c.useEffect(()=>{if(!t){n(""),h(null),d(!1);return}const v=(()=>{try{const l=localStorage.getItem("dichHistory")||"[]",y=JSON.parse(l).find(C=>{const b=JSON.parse(decodeURIComponent(atob(C)));return b.inputText===t&&JSON.stringify(b.options)===JSON.stringify(i)});return y?JSON.parse(decodeURIComponent(atob(y))):null}catch{return null}})();if(v){console.log("Tìm thấy kết quả trong cache."),n(v.aiCallBack),d(!1),h(null);return}(async()=>{d(!0),h(null);try{const l=await _(t,i);u(t,i,l),n(l)}catch(l){l.response&&l.response.status===429&&alert("Bạn đã gửi quá nhiều yêu cầu. Vui lòng thử lại sau một lát."),h(l),n("")}finally{d(!1)}})()},[t,i]),e.jsx(k.Provider,{value:{options:i,inputText:t,aiCallBack:s,isLoading:a,error:f,setOptions:x,setInputText:o},children:e.jsxs("section",{className:"min-h-screen px-5 mb-5 xl:p-0",children:[e.jsx("div",{className:"mb-5",children:r}),e.jsx(E,{}),e.jsxs("div",{className:"w-full flex flex-col gap-10",children:[e.jsx(U,{}),e.jsx(K,{})]})]})})}export{k as DichContext,ee as default};
