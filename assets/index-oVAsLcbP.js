import{r,R as z,j as t,I as G,aa as A,u as Q,ab as U}from"./index-DVRot9C2.js";import{u as q}from"./index-CbeaNALU.js";import{B as W,a as Z,T as tt,v as et}from"./ButtonToolJLPT-D96aWrpf.js";import{u as st}from"./index-ojk2z693.js";import"./Model-CPyvh6yY.js";import"./index-t--hEgTQ.js";import"./index-B7iHZlXM.js";import"./Breadcrumbs-CtQaSOfD.js";const _=i=>{if(!i)return;const[o,m]=r.useState({}),[y,$]=r.useState({}),[R,I]=r.useState({}),[S,M]=r.useState(!1),p=r.useRef([]),c=r.useRef([]),b=r.useRef([]),j=/([\u4e00-\u9faf]+|\d+)\s*[（(](.*?)[）)]/g,k=String(i).match(/<truvndich>(.*?)<\/truvndich>/);i=String(i).replace(/<truvndich>(.*?)<\/truvndich>/,"");const w=[...i.matchAll(j)];p.current=w.map((s,e)=>p.current[e]??z.createRef()),c.current=w.map((s,e)=>c.current[e]??z.createRef()),b.current=w.map((s,e)=>b.current[e]??z.createRef());const C=s=>{m(e=>({...e,[s]:!e[s]}))};r.useEffect(()=>{(()=>{const e={...y},v={...R},u=Object.keys(o).filter(n=>o[n]).sort((n,f)=>{var x,g,a,h;const l=(g=(x=c.current[n])==null?void 0:x.current)==null?void 0:g.getBoundingClientRect(),d=(h=(a=c.current[f])==null?void 0:a.current)==null?void 0:h.getBoundingClientRect();return((l==null?void 0:l.left)||0)-((d==null?void 0:d.left)||0)});u.forEach(n=>{e[n]="top",v[n]=0});for(let n=1;n<u.length;n++){const f=u[n],l=p.current[f];if(!(l!=null&&l.current))continue;const d=l.current.getBoundingClientRect();for(let x=0;x<n;x++){const g=u[x],a=p.current[g];if(!(a!=null&&a.current))continue;const h=a.current.getBoundingClientRect();if(d.left<h.right&&d.right>h.left){e[f]="bottom";break}}}$(e);const E=u.filter(n=>e[n]==="top"),F=u.filter(n=>e[n]==="bottom"),N=n=>{for(let f=1;f<n.length;f++){const l=n[f],d=p.current[l];if(!(d!=null&&d.current))continue;const x=d.current.getBoundingClientRect();for(let g=0;g<f;g++){const a=n[g],h=p.current[a];if(!(h!=null&&h.current))continue;const L=h.current.getBoundingClientRect();if(x.left<L.right&&x.right>L.left){v[l]=(v[a]||0)+L.height;break}}}};N(E),N(F),I(v)})()},[o]),r.useEffect(()=>{w.forEach((s,e)=>{var E,F,N;const v=(E=p.current[e])==null?void 0:E.current,P=(F=c.current[e])==null?void 0:F.current,u=(N=b.current[e])==null?void 0:N.current;if(v&&P&&u&&o[e]){const n=v.getBoundingClientRect(),f=P.getBoundingClientRect(),l=P.parentElement.getBoundingClientRect(),d=(n.left+n.right)/2,x=(f.left+f.right)/2;let g,a;y[e]==="bottom"?(g=n.bottom,a=f.top):(g=n.top,a=f.bottom);const h=Math.min(g,a)-l.top,L=Math.abs(g-a),Y=Math.min(d,x)-l.left-5,D=Math.max(d,x)-l.left+5-Y,J=g-(h+l.top),K=a-(h+l.top),X=d-(Y+l.left),H=x-(Y+l.left),V=`M${X} ${J} V${K} H${H}`;u.setAttribute("width",D),u.setAttribute("height",L),u.style.left=`${Y}px`,u.style.top=`${h}px`,u.innerHTML=`<path d="${V}" stroke="#b91c1c" stroke-width="1.5" fill="none" />`}})});let T=0;const B=[];w.forEach((s,e)=>{const v=s[0],P=s[1],u=s[2],E=s.index,F=R[e]||0,N=i.substring(T,E);N&&B.push(t.jsx(z.Fragment,{children:N},`pre-${e}`));const n=y[e]||"top";B.push(t.jsxs("span",{style:{position:"relative",display:"inline-block"},children:[t.jsx("span",{ref:c.current[e],onMouseEnter:()=>C(e),onMouseLeave:()=>C(e),style:{cursor:"pointer",borderBottom:"1px dotted #234212"},children:P},`kanji-${e}`),o[e]&&t.jsxs(t.Fragment,{children:[t.jsx("span",{ref:p.current[e],className:"text-sm text-red-800 bg-amber-50/90 shadow shadow-amber-800/50 rounded-sm px-1",style:{position:"absolute",[n]:`calc(100% + ${F}px)`,left:"50%",transform:"translateX(-50%)",whiteSpace:"nowrap",zIndex:10},children:u},`furigana-${e}`),t.jsx("svg",{ref:b.current[e],style:{position:"absolute",zIndex:9,overflow:"visible"}})]})]},`container-${e}`)),T=E+v.length});const O=i.substring(T);return O&&B.push(t.jsx(z.Fragment,{children:O},"remaining")),t.jsxs("div",{className:"relative flex flex-col",children:[t.jsxs("div",{children:[t.jsx("div",{className:"pr-6",children:B}),k&&t.jsx("div",{className:"z-20 cursor-pointer hover:bg-indigo-400 hover:text-white  text-[9px] text-indigo-800 font-bold absolute px-2 py-1 rounded-full bg-white border border-indigo-800  top-1/2 -translate-y-1/2 right-0 translate-x-1/2 transition-all",onClick:()=>M(s=>!s),children:t.jsx("p",{children:S?t.jsx(G,{iconName:"faClose"}):"Dịch"})})]}),S&&k&&t.jsx("p",{className:"z-10 absolute top-1/2 text-xs h-full w-full scroll-y-auto -translate-y-1/2 left-0 text-white bg-gray-600 px-2 rounded-md italic",children:k[1]})]})},nt=r.memo(({dapAn:i,id:o,isSelected:m,isSuccess:y,onClick:$,index:R})=>{const{settings:I}=r.useContext(A),{styleFontSize:S}=I,M=`cursor-pointer px-4 py-1 w-full rounded-l-2xl  transition-all ${m?"border-gray-800 dark:border-white":"border-transparent"} ${m&&y?"  rounded-l-2xl transition-all text-white duration-200 bg-gradient-to-r from-green-900  via-green-800 via-95% to-transparent":m&&!y?" rounded-l-2xl transition-all text-white duration-200 bg-gradient-to-r from-red-900  via-red-800 via-90% to-transparent":""}`;return t.jsxs("li",{style:{fontSize:`${S}px`},className:`relative bg-[var(--color-main)]/5 rounded-2xl ${i===""?"hidden":"flex gap-2 items-center"}`,children:[t.jsx("input",{className:"peer/trung hidden",type:"checkbox",name:o,id:o,checked:m,readOnly:!0}),t.jsx("div",{className:"absolute  left-0 -translate-x-1/2 top-1/2 -translate-y-1/2  bg-white h-5 w-5 border rounded-full  border-indigo-800",children:t.jsx("p",{className:"text-indigo-800 text-sm font-bold absolute  left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2",children:R+1})}),t.jsx("label",{htmlFor:o,className:M,onClick:$,children:t.jsx("div",{children:_(i)})})]})}),rt=r.memo(({data:i,index:o,settings:m})=>{if(!(i!=null&&i.cauhoi))return null;const{settings:y}=r.useContext(A),{styleColumn:$,styleFontSize:R}=y,{styleGDTrueFalse:I,styleColorTitle:S,styleColorShadow:M}=m,{dapan:p,cauhoi:c,img:b}=i,[j,k]=r.useState([]),w=r.useMemo(()=>j[o]!==void 0&&j[o]!==null,[j,o]),C=r.useMemo(()=>j[o]===p,[j,o,p]),T=r.useCallback(s=>{k(e=>{const v=[...e];return v[o]=Number(s),v})},[o]),B=()=>{const s="jlpt text-lg font-bold";return I?w&&C?`${s} text-green-800 border-b-2 border-green-800 transition-all duration-200`:w&&!C?`${s} text-red-800 border-b-2 border-red-800 transition-all duration-200`:`${s} text-gray-800 dark:text-white border-b-2 border-transparent transition-all duration-200`:s},O=()=>w&&C?"#016630":w?"#9f0712":M;return t.jsx("div",{style:{"--jlpt-color-shadow-box":O()},className:"jlptBorderShadow p-4 rounded-md font-Japan",children:t.jsxs("div",{className:"flex flex-col gap-2",children:[b&&t.jsx("img",{src:b,alt:"img",className:"w-1/3 mx-auto"}),t.jsxs("div",{className:"flex gap-2 items-start",children:[t.jsx("div",{className:"w-full flex items-center gap-4",style:{fontSize:`${R}px`},children:t.jsx("h2",{style:{"--jlpt-title-u":S},className:B(),children:_(c)||"Loading..."})}),t.jsx(W,{data:i})]}),t.jsx("ul",{className:`grid gap-2 ${$===1?"grid-cols-1":"grid-cols-2"}`,children:[1,2,3,4].map((s,e)=>t.jsx(nt,{dapAn:i[`dapan${s}`]||"",isSelected:j[o]===s,isSuccess:C&&j[o]===s,onClick:()=>T(s),index:e},`${c}-${o}-${s}`))})]})})});function ht(){const[i,o]=r.useState([]),{itemId:m}=Q(),{settings:y}=r.useContext(A),$=m.substring(m.length-3,m.length),R=r.useMemo(()=>{const b=window.location.href;return new URL(b).pathname.split("/").filter(T=>T!=="")[1]},[m]),I=`GET=tokutei&db=${$}&path=${R}`,S=r.useRef(""),M=st(),{loading:p,apiData:c}=q(`https://script.google.com/macros/s/AKfycbz59u6ng7B-x442h3wgLCuMvZM2tvuVXLMYkYmFlIk_vsY9j8qgCMHR6NeQb0QpL2NMTg/exec?${I}`);return r.useEffect(()=>{c!=null&&c.data&&(o(c.data),S.current="")},[c]),r.useEffect(()=>{window.scrollY&&window.scrollTo({top:0,behavior:"smooth"})},[]),p?t.jsx(U,{}):t.jsxs("div",{className:"flex flex-col w-full min-h-screen trungSelectData",children:[t.jsx("div",{className:"px-5",children:M}),t.jsxs("div",{className:"z-50 w-full sticky top-20",children:[t.jsx(Z,{view:c==null?void 0:c.views}),t.jsx(tt,{})]}),t.jsxs("div",{className:"flex flex-col gap-2 dark:bg-bgColor/50 rounded-2xl px-5 py-5",children:[t.jsx("h1",{className:"text-2xl font-bold text-red-800 dark:text-white text-center my-5",children:(c==null?void 0:c.title)||""}),i.length>0?i.map((b,j)=>{const k={...b};return t.jsx(rt,{data:k,index:j,settings:y},b.id||et())}):t.jsx("h1",{className:"text-2xl font-bold text-center",children:"Không có dữ liệu"})]})]})}export{ht as default};
