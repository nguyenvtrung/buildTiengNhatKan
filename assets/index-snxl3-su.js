import{r,R as z,j as t,I as G,aa as A,u as Q,ab as U}from"./index-CbkCS8gm.js";import{u as q}from"./index-nOZX6KUg.js";import{B as W,a as Z,T as tt,v as et}from"./ButtonToolJLPT-BeLvpdzg.js";import{u as st}from"./index-Cpj2vdWF.js";import"./Model-DzGr2aID.js";import"./index-t--hEgTQ.js";import"./index-BhmkHKuL.js";import"./Breadcrumbs-D_GCQVR_.js";const D=i=>{if(!i)return;const[o,p]=r.useState({}),[w,I]=r.useState({}),[R,M]=r.useState({}),[S,T]=r.useState(!1),x=r.useRef([]),c=r.useRef([]),y=r.useRef([]),f=/([\u4e00-\u9faf]+|\d+)\s*[（(](.*?)[）)]/g,k=String(i).match(/<truvndich>(.*?)<\/truvndich>/);i=String(i).replace(/<truvndich>(.*?)<\/truvndich>/,"");const b=[...i.matchAll(f)];x.current=b.map((s,e)=>x.current[e]??z.createRef()),c.current=b.map((s,e)=>c.current[e]??z.createRef()),y.current=b.map((s,e)=>y.current[e]??z.createRef());const C=s=>{p(e=>({...e,[s]:!e[s]}))};r.useEffect(()=>{(()=>{const e={...w},v={...R},u=Object.keys(o).filter(n=>o[n]).sort((n,g)=>{var j,h,a,m;const l=(h=(j=c.current[n])==null?void 0:j.current)==null?void 0:h.getBoundingClientRect(),d=(m=(a=c.current[g])==null?void 0:a.current)==null?void 0:m.getBoundingClientRect();return((l==null?void 0:l.left)||0)-((d==null?void 0:d.left)||0)});u.forEach(n=>{e[n]="top",v[n]=0});for(let n=1;n<u.length;n++){const g=u[n],l=x.current[g];if(!(l!=null&&l.current))continue;const d=l.current.getBoundingClientRect();for(let j=0;j<n;j++){const h=u[j],a=x.current[h];if(!(a!=null&&a.current))continue;const m=a.current.getBoundingClientRect();if(d.left<m.right&&d.right>m.left){e[g]="bottom";break}}}I(e);const E=u.filter(n=>e[n]==="top"),F=u.filter(n=>e[n]==="bottom"),$=n=>{for(let g=1;g<n.length;g++){const l=n[g],d=x.current[l];if(!(d!=null&&d.current))continue;const j=d.current.getBoundingClientRect();for(let h=0;h<g;h++){const a=n[h],m=x.current[a];if(!(m!=null&&m.current))continue;const L=m.current.getBoundingClientRect();if(j.left<L.right&&j.right>L.left){v[l]=(v[a]||0)+L.height;break}}}};$(E),$(F),M(v)})()},[o]),r.useEffect(()=>{b.forEach((s,e)=>{var E,F,$;const v=(E=x.current[e])==null?void 0:E.current,P=(F=c.current[e])==null?void 0:F.current,u=($=y.current[e])==null?void 0:$.current;if(v&&P&&u&&o[e]){const n=v.getBoundingClientRect(),g=P.getBoundingClientRect(),l=P.parentElement.getBoundingClientRect(),d=(n.left+n.right)/2,j=(g.left+g.right)/2;let h,a;w[e]==="bottom"?(h=n.bottom,a=g.top):(h=n.top,a=g.bottom);const m=Math.min(h,a)-l.top,L=Math.abs(h-a),Y=Math.min(d,j)-l.left-5,_=Math.max(d,j)-l.left+5-Y,J=h-(m+l.top),K=a-(m+l.top),X=d-(Y+l.left),H=j-(Y+l.left),V=`M${X} ${J} V${K} H${H}`;u.setAttribute("width",_),u.setAttribute("height",L),u.style.left=`${Y}px`,u.style.top=`${m}px`,u.innerHTML=`<path d="${V}" stroke="#b91c1c" stroke-width="1.5" fill="none" />`}})});let B=0;const N=[];b.forEach((s,e)=>{const v=s[0],P=s[1],u=s[2],E=s.index,F=R[e]||0,$=i.substring(B,E);$&&N.push(t.jsx(z.Fragment,{children:$},`pre-${e}`));const n=w[e]||"top";N.push(t.jsxs("span",{style:{position:"relative",display:"inline-block"},children:[t.jsx("span",{ref:c.current[e],onMouseEnter:()=>C(e),onMouseLeave:()=>C(e),style:{cursor:"pointer",borderBottom:"1px dotted #234212"},children:P},`kanji-${e}`),o[e]&&t.jsxs(t.Fragment,{children:[t.jsx("span",{ref:x.current[e],className:"text-sm text-red-800 bg-amber-50/90 shadow shadow-amber-800/50 rounded-sm px-1",style:{position:"absolute",[n]:`calc(100% + ${F}px)`,left:"50%",transform:"translateX(-50%)",whiteSpace:"nowrap",zIndex:10},children:u},`furigana-${e}`),t.jsx("svg",{ref:y.current[e],style:{position:"absolute",zIndex:9,overflow:"visible"}})]})]},`container-${e}`)),B=E+v.length});const O=i.substring(B);return O&&N.push(t.jsx(z.Fragment,{children:O},"remaining")),t.jsxs("div",{className:"relative flex flex-col",children:[t.jsxs("div",{children:[t.jsx("div",{className:"pr-6",children:N}),k&&t.jsx("div",{className:"z-20 cursor-pointer hover:bg-indigo-400 hover:text-white  text-[9px] text-indigo-800 font-bold absolute px-2 py-1 rounded-full bg-white border border-indigo-800  top-1/2 -translate-y-1/2 right-0 translate-x-1/2 transition-all",onClick:()=>T(s=>!s),children:t.jsx("p",{children:S?t.jsx(G,{iconName:"faClose"}):"Dịch"})})]}),S&&k&&t.jsx("p",{className:"z-10 absolute top-1/2 text-xs h-full w-full scroll-y-auto -translate-y-1/2 left-0 text-white bg-gray-600 px-2 rounded-md italic",children:k[1]})]})},nt=r.memo(({dapAn:i,id:o,isSelected:p,isSuccess:w,onClick:I,index:R})=>{const{settings:M}=r.useContext(A),{styleFontSize:S}=M,T=`cursor-pointer px-4 py-1 w-full rounded-l-2xl  transition-all ${p?"border-gray-800 dark:border-white":"border-transparent"} ${p&&w?"  rounded-l-2xl transition-all text-white duration-200 bg-gradient-to-r from-green-900  via-green-800 via-95% to-transparent":p&&!w?" rounded-l-2xl transition-all text-white duration-200 bg-gradient-to-r from-red-900  via-red-800 via-90% to-transparent":""}`;return t.jsxs("li",{style:{fontSize:`${S}px`},className:`relative bg-[var(--color-main)]/5 rounded-2xl ${i===""?"hidden":"flex gap-2 items-center"}`,children:[t.jsx("input",{className:"peer/trung hidden",type:"checkbox",name:o,id:o,checked:p,readOnly:!0}),t.jsx("div",{className:"absolute  left-0 -translate-x-1/2 top-1/2 -translate-y-1/2  bg-white h-5 w-5 border rounded-full  border-indigo-800",children:t.jsx("p",{className:"text-indigo-800 text-sm font-bold absolute  left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2",children:R+1})}),t.jsx("label",{htmlFor:o,className:T,onClick:I,children:t.jsx("div",{children:D(i)})})]})}),rt=r.memo(({data:i,index:o,settings:p})=>{if(!(i!=null&&i.cauhoi))return null;const{settings:w}=r.useContext(A),{styleColumn:I,styleFontSize:R}=w,{styleGDTrueFalse:M,styleColorTitle:S,styleColorShadow:T}=p,{dapan:x,cauhoi:c,img:y}=i,[f,k]=r.useState([]),b=r.useMemo(()=>f[o]!==void 0&&f[o]!==null,[f,o]),C=r.useMemo(()=>f[o]===x,[f,o,x]),B=r.useCallback(s=>{k(e=>{const v=[...e];return v[o]=Number(s),v})},[o]),N=()=>{const s="jlpt text-lg font-bold";return M?b&&C?`${s} text-green-800 border-b-2 border-green-800 transition-all duration-200`:b&&!C?`${s} text-red-800 border-b-2 border-red-800 transition-all duration-200`:`${s} text-gray-800 dark:text-white border-b-2 border-transparent transition-all duration-200`:s},O=()=>b&&C?"#016630":b?"#9f0712":T;return t.jsx("div",{style:{"--jlpt-color-shadow-box":O()},className:"jlptBorderShadow p-4 rounded-md font-Japan",children:t.jsxs("div",{className:"flex flex-col gap-2",children:[y&&t.jsx("img",{src:y,alt:"img",className:"w-1/3 mx-auto"}),t.jsxs("div",{className:"flex gap-2 items-start",children:[t.jsx("div",{className:"w-full flex items-center gap-4",style:{fontSize:`${R}px`},children:t.jsx("h2",{style:{"--jlpt-title-u":S},className:N(),children:D(c)||"Loading..."})}),t.jsx(W,{data:i})]}),t.jsx("ul",{className:`grid gap-2 ${I===1?"grid-cols-1":"grid-cols-2"}`,children:[1,2,3,4].map((s,e)=>t.jsx(nt,{dapAn:i[`dapan${s}`]||"",isSelected:f[o]===s,isSuccess:C&&f[o]===s,onClick:()=>B(s),index:e},`${c}-${o}-${s}`))})]})})});function ht(){const[i,o]=r.useState([]),{itemId:p}=Q(),{settings:w}=r.useContext(A),I=p.substring(p.length-3,p.length),R=r.useMemo(()=>{const f=window.location.href;return new URL(f).pathname.split("/").filter(N=>N!=="")[1]},[p]),M=`GET=tokutei&db=${I}&path=${R}`,S=r.useRef(""),T=st(),{loading:x,apiData:c,fetchData:y}=q(`https://script.google.com/macros/s/AKfycbz59u6ng7B-x442h3wgLCuMvZM2tvuVXLMYkYmFlIk_vsY9j8qgCMHR6NeQb0QpL2NMTg/exec?${M}`,!1,{manual:!0});return r.useEffect(()=>{c!=null&&c.data&&(o(c.data),S.current="")},[c]),r.useEffect(()=>{y(),window.scrollY&&window.scrollTo({top:0,behavior:"smooth"})},[]),x?t.jsx(U,{}):t.jsxs("div",{className:"flex flex-col w-full min-h-screen trungSelectData",children:[t.jsx("div",{className:"px-5",children:T}),t.jsxs("div",{className:"z-50 w-full sticky top-20",children:[t.jsx(Z,{view:c==null?void 0:c.views}),t.jsx(tt,{})]}),t.jsxs("div",{className:"flex flex-col gap-2 dark:bg-bgColor/50 rounded-2xl px-5 py-5",children:[t.jsx("h1",{className:"text-2xl font-bold text-red-800 dark:text-white text-center my-5",children:(c==null?void 0:c.title)||""}),i.length>0?i.map((f,k)=>{const b={...f};return t.jsx(rt,{data:b,index:k,settings:w},f.id||et())}):t.jsx("h1",{className:"text-2xl font-bold text-center",children:"Không có dữ liệu"})]})]})}export{ht as default};
